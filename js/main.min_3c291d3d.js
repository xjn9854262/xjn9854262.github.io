var __reflect=this&&this.__reflect||function(e,t,r){e.__class__=t,r?r.push(t):r=[t],e.__types__=e.__types__?r.concat(e.__types__):r},__extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);r.prototype=t.prototype,e.prototype=new r},__awaiter=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))(function(n,i){function a(e){try{l(o.next(e))}catch(t){i(t)}}function s(e){try{l(o["throw"](e))}catch(t){i(t)}}function l(e){e.done?n(e.value):new r(function(t){t(e.value)}).then(a,s)}l((o=o.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function r(e){return function(t){return o([e,t])}}function o(r){if(n)throw new TypeError("Generator is already executing.");for(;l;)try{if(n=1,i&&(a=i[2&r[0]?"return":r[0]?"throw":"next"])&&!(a=a.call(i,r[1])).done)return a;switch(i=0,a&&(r=[0,a.value]),r[0]){case 0:case 1:a=r;break;case 4:return l.label++,{value:r[1],done:!1};case 5:l.label++,i=r[1],r=[0];continue;case 7:r=l.ops.pop(),l.trys.pop();continue;default:if(a=l.trys,!(a=a.length>0&&a[a.length-1])&&(6===r[0]||2===r[0])){l=0;continue}if(3===r[0]&&(!a||r[1]>a[0]&&r[1]<a[3])){l.label=r[1];break}if(6===r[0]&&l.label<a[1]){l.label=a[1],a=r;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(r);break}a[2]&&l.ops.pop(),l.trys.pop();continue}r=t.call(e,l)}catch(o){r=[6,o],i=0}finally{n=a=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var n,i,a,s,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:r(0),"throw":r(1),"return":r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},BaseStateDbModel=function(e){function t(){var t=e.call(this)||this;return t._behaviorLoopTime=0,t._startDecodeTime=0,t.isDie=!1,t.isSpecial=!1,t}return __extends(t,e),Object.defineProperty(t.prototype,"StateMgr",{get:function(){var e=this;return e._stateMgr},set:function(e){var t=this;t._stateMgr=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Info",{get:function(){var e=this;return e._mInfo},set:function(e){var t=this;t._mInfo=e,t.initDb()},enumerable:!0,configurable:!0}),t.prototype.initDb=function(){},t.prototype.updateTime=function(e){var t=this;if(t._loopTime+=e,t.update(e),t._behaviorList&&t._behaviorList.length>0){var r=t._loopTime-t._startDecodeTime;r>=t._behaviorLoopTime&&0!=t._behaviorLoopTime&&(t._nowPlayerBehaivor.pop(),t.queneState(t._behaviorList))}},t.prototype.update=function(e){},t.prototype.playAction=function(e,t){var r=this;switch(e){case Enum_state.attack:r.hit(t);break;case Enum_state.idle:r.idle(t);break;case Enum_state.running:r.run(t);break;case Enum_state.hurt:r.hurt(t);break;case Enum_state.die:r.death(t);break;case Enum_state.cool:r.idle(t);break;case Enum_state.skill:r.skill(t);break;default:console.error("异常状态："+e)}},t.prototype.parallelState=function(e){var t=this;for(t._nowPlayerBehaivor=e;e.length>0;){var r=e.shift(),o=r._state;t.playAction(o,r._param)}},t.prototype.queneState=function(e){var t=this;if(e&&e.length>0){var r=e.shift();t.playAction(r._state,r._param),t._nowPlayerBehaivor.push(r),t._behaviorLoopTime=r._loopTiem}},t.prototype.decodeAction=function(e,t){var r=this,o=e._behaviorList,n=e._type;r._loopTime=r._startDecodeTime;var i=[r.parallelState,r.queneState];r._nowPlayerBehaivor=[],r._behaviorList=o,i[n].call(r,o),t&&t.call(r)},t.prototype.run=function(e){},t.prototype.hit=function(e){},t.prototype.hurt=function(e){},t.prototype.cure=function(e){},t.prototype.idle=function(e){},t.prototype.death=function(e){},t.prototype.skill=function(e){},t.prototype.dispose=function(){},t.prototype.clean=function(){},t}(egret.Sprite);__reflect(BaseStateDbModel.prototype,"BaseStateDbModel");var BaseStateModel=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.partMap={},t._behaviorLoopTime=0,t._startDecodeTime=0,t.isDie=!1,t.isSpecial=!1,t._prec=0,t}return __extends(t,e),Object.defineProperty(t.prototype,"StateMgr",{get:function(){var e=this;return e._stateMgr},set:function(e){var t=this;t._stateMgr=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Info",{get:function(){var e=this;return e._mInfo},set:function(e){var t=this;t._mInfo=e,t.initPart()},enumerable:!0,configurable:!0}),t.prototype.initPart=function(){},Object.defineProperty(t.prototype,"prec",{get:function(){var e=this;return e._prec},set:function(e){var t=this;t._prec=e,e>=1&&(e=.999);var r=t.partMap;for(var o in r){var n=r[o];n&&n.setPec(e)}},enumerable:!0,configurable:!0}),t.prototype.updateTime=function(e){var t=this;if(t._loopTime+=e,t.update(e),t._behaviorList&&t._behaviorList.length>0){var r=t._loopTime-t._startDecodeTime;r>=t._behaviorLoopTime&&0!=t._behaviorLoopTime&&(t._nowPlayerBehaivor.pop(),t.queneState(t._behaviorList))}},t.prototype.update=function(e){},t.prototype.playAction=function(e,t){var r=this;switch(e){case Enum_state.attack:r.hit(t);break;case Enum_state.idle:r.idle(t);break;case Enum_state.running:r.run(t);break;case Enum_state.hurt:r.hurt(t);break;case Enum_state.die:r.death(t);break;case Enum_state.cool:r.idle(t);break;default:console.error("异常状态："+e)}},t.prototype.parallelState=function(e){var t=this;for(t._nowPlayerBehaivor=e;e.length>0;){var r=e.shift(),o=r._state;t.playAction(o,r._param)}},t.prototype.queneState=function(e){var t=this;if(e&&e.length>0){var r=e.shift();t.playAction(r._state,r._param),t._nowPlayerBehaivor.push(r),t._behaviorLoopTime=r._loopTiem}},t.prototype.decodeAction=function(e,t){var r=this,o=e._behaviorList,n=e._type;r._loopTime=r._startDecodeTime;var i=[r.parallelState,r.queneState];r._nowPlayerBehaivor=[],r._behaviorList=o,i[n].call(r,o),t&&t.call(r)},t.prototype.run=function(e){},t.prototype.hit=function(e){},t.prototype.hurt=function(e){},t.prototype.cure=function(e){},t.prototype.idle=function(e){},t.prototype.death=function(e){},t.prototype.dispose=function(){var e=this;for(var t in e.partMap){var r=e.parent[t];r&&r.dispose&&r.dispose()}},t.prototype.clean=function(){},t}(egret.Sprite);__reflect(BaseStateModel.prototype,"BaseStateModel");var BaseLifeModel=function(e){function t(){var t=e.call(this)||this;return t.attackWidth=0,t.speed=1250,t._loadCount=0,t._loadCallNum=0,t}return __extends(t,e),t.prototype.idle=function(e){var t=this,r=t.partMap;for(var o in r){var n=r[o];n&&n.setActName("Idle")}},t.prototype.run=function(e){var t=this,r=t.partMap;for(var o in r){var n=r[o];n&&n.setActName("Run")}},t.prototype.hurt=function(e){var t=this,r=t.partMap;for(var o in r){var n=r[o];n&&n.setActName("Idle")}e&&(t.Info.life-=e.Info.attack,t.Info.life<=0&&(t._stateMgr.addState(StateHelper.createState(1,[{state:Enum_state.die,time:600}]),!0,!0),t.isDie=!0),console.error("受到了:"+e.Info.attack+"伤害 还剩:"+t.Info.life+"血量")),t.StateMgr._flag="stopRender",t.rotation=-15*t.scaleX;var i=function(){t.rotation=0,t.StateMgr._flag="decodeAction",TimerUtils.instance.remove(i,t)};TimerUtils.instance.listen(i,t,80,egret.getTimer()+80)},t.prototype.death=function(e){var t=this,r=t.partMap;for(var o in r){var n=r[o];n&&n.setActName("Die")}},t.prototype.loadComplate=function(){var e=this;e._loadCallNum++,e._loadCount==e._loadCallNum&&(console.error("init call back!"),e.attackWidth=e.width)},t.prototype.searchNearEnemyUnit=function(e){function t(e,t){var i=t._mModel,a=Math.pow(i.x-r.x,2),s=Math.pow(i.y-r.y,2),l=Math.sqrt(a+s);e>l&&(n=l,o=t)}var r=this,o=null,n=99999;if(1==e.length)return e[0];for(var i=0,a=e;i<a.length;i++){var s=a[i];t(n,s)}return o},t.prototype.initPart=function(){console.error("设置了实体数据开始生成元件");var e=this;e.astar=new AStar2;var t=e.Info;e.scaleX=t.isScale?-1:1},t.prototype.update=function(e){var t=this,r=(t._loopTime-t._startDecodeTime)/t.speed;r>1&&(r-=r>>0),t.prec=r,t.check()},t.prototype.check=function(){var e=this,t=e._nowPlayerBehaivor[0],r=t._state,o=App.mapMgr.mapMgr.mGrid;if(!e.enemy||"cleanItem"==e.enemy._flag){var n=App.mapMgr.getOtherUnit(e._unitKey);0==n.length?e.enemy=App.mapMgr.getSpecialUnit():e.enemy=e.searchNearEnemyUnit(n)}var i=e.enemy,a=e.enemy._mModel,s=new egret.Point(e.x,e.y),l=e.attackWidth,p=new egret.Point(a&&a.x||i.x,a&&a.y||i.y),c=e.x-(a&&a.x||i.x)>0?!0:!1,u=function(e,t,r){return Math.pow(e.x-r.x,2)+Math.pow(e.y-r.y,2)>Math.pow(t,2)?!1:!0},h=!1;switch(r){case Enum_state.attack:MTween.remove(e),c?e.scaleX=-1:e.scaleX=1;break;case Enum_state.hurt:MTween.remove(e);break;case Enum_state.idle:if(MTween.remove(e),!o)return void console.error("a星网格还没初始化完成。。。");if(e._lstChecPathkTime){if(e._loopTime-e._lstChecPathkTime<800)return;e._lstChecPathkTime=e._loopTime}else e._lstChecPathkTime=e._loopTime;if(h=u(s,l,p))return MTween.remove(e),void e.StateMgr.addState(StateHelper.createState(1,[{state:Enum_state.attack,time:1200}],function(){a&&!egret.is(e,"RemoteSoldier")&&a.StateMgr.addState(StateHelper.createState(1,[{state:Enum_state.hurt,time:80,param:e}]),!0)}),!0);var d=Math.ceil(e.x/AppConst.ITEM_NODE_SIZE),f=Math.ceil(e.y/AppConst.ITEM_NODE_SIZE),_=o.getNode(d,f),y=void 0,m=0;a?(y=Math.ceil(a.x/AppConst.ITEM_NODE_SIZE),m=Math.ceil(a.y/AppConst.ITEM_NODE_SIZE)):(y=Math.ceil(i.x/AppConst.ITEM_NODE_SIZE),m=Math.ceil(i.y/AppConst.ITEM_NODE_SIZE));var v=o.getNode(y,m);if(e.astar.findPath(App.mapMgr.mapMgr.mGrid,_,v)){e.astar.floyd(),e.astar.floydPath.shift();var g=e.astar.floydPath;e.runPath(g),e.StateMgr.addState(StateHelper.createState(1,[{state:Enum_state.running,time:-1}]),!0)}else e.idle();break;case Enum_state.running:h=u(s,l,p),h&&(MTween.remove(e),e.StateMgr.addState(StateHelper.createState(1,[{state:Enum_state.attack,time:1200}],function(){a&&!egret.is(e,"RemoteSoldier")&&a.StateMgr.addState(StateHelper.createState(1,[{state:Enum_state.hurt,time:80,param:e}]),!0)}),!0));break;case Enum_state.die:}},t.prototype.runPath=function(e){var t=this;for(new Array;e&&e.length>0;){var r=e.shift(),o=r.x*AppConst.ITEM_NODE_SIZE,n=r.y*AppConst.ITEM_NODE_SIZE,i=o-t.x,a=n-t.y,s=Math.sqrt(i*i+a*a);if(1>s);else{MTween.remove(t);var l=10,p=s*l;t.scaleX=i>0?1:-1;var c=t.x+i,u=t.y+a;MTween.to(t,{x:c,y:u},p,null,function(){t.StateMgr.addState(StateHelper.createState(1,[{state:Enum_state.idle,time:-1}]))},t)}}},t}(BaseStateModel);__reflect(BaseLifeModel.prototype,"BaseLifeModel");var FkComButton=function(e){function t(){var t=e.call(this)||this;return t._text="",t._color=15856371,t._size=26,t._disabled=!1,t._icon="",t._isNinth=!0,t.skinName="resource/skin/componments/FkComButton.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this);var t=this;t.bg.source=t._icon,t.lb.text=t._text,t.lb.textColor=t._color,t.lb.size=t._size,t.touchChildren=!1,t._isNinth&&(t.bg.scale9Grid=new egret.Rectangle(t.bg.width/2,t.bg.height/2,1,1)),t.addStyleEvent()},t.prototype.addStyleEvent=function(){UIHelper.addTouchState(this)},t.prototype.removeStyleEvent=function(){UIHelper.removeTouchState(this)},Object.defineProperty(t.prototype,"icon",{get:function(){var e=this;return e._icon},set:function(e){var t=this;t._icon=e,t.bg&&(t.bg.source=e),t._isNinth&&(t.bg.scale9Grid=new egret.Rectangle(t.bg.width/2,t.bg.height/2,1,1))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"text",{get:function(){var e=this;return e._text},set:function(e){var t=this;t._text=e,t.lb&&(t.lb.text=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){var e=this;return e.lb.textColor},set:function(e){var t=this;t._color=e,t.lb&&(t.lb.textColor=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textSize",{get:function(){var e=this;return e.lb.size},set:function(e){var t=this;t._size=e,t.lb&&(t.lb.size=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Ninth",{get:function(){var e=this;return e._isNinth},set:function(e){var t=this;t._isNinth=e,e?t.bg.scale9Grid=new egret.Rectangle(t.bg.width/2,t.bg.height/2,1,1):t.bg.scale9Grid=null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"disabled",{get:function(){var e=this;return e._disabled},set:function(e){var t=this;t._disabled=e,t.touchEnabled=t.touchChildren=!e,e?(t._colorFilter||(t._colorFilter=ColorFilter.GRAY_FLITER),t.filters=[t._colorFilter]):t.filters=null},enumerable:!0,configurable:!0}),t}(eui.Component);__reflect(FkComButton.prototype,"FkComButton");var BaseControl=function(){function e(){}return e}();__reflect(BaseControl.prototype,"BaseControl",["ControlInterface"]);var BaseLifeDbModel=function(e){function t(){var t=e.call(this)||this;t.attackWidth=0,t.attackTime=500,t.coolTime=350,t.scaleVal=.3,t._isUseSkill=!1;var r=t;return App.notice.listen(EventConst.BATTLE_MODEL_DEATH,r.targetDieEvt,r),t}return __extends(t,e),t.prototype.targetDieEvt=function(e){var t=this,r=e.hurtBody;t.enemy._mModel._unitKey==r._unitKey&&(t.enemy=null)},t.prototype.idle=function(e){var t=this;t.dbModel&&t.dbModel.animation.play("stand",0)},t.prototype.run=function(e){var t=this;t.dbModel&&t.dbModel.animation.play("move1",0)},t.prototype.hurt=function(e){var t=this;t._isUseSkill||(t._isUseSkill=!0,t.StateMgr.addState(StateHelper.createState(StateHelper.TYPE_QUENE,[{state:Enum_state.skill,time:1e3}])));var r=function(){t.hitImg.visible=!1,TimerUtils.instance.remove(r,t)};t.hitImg.y=-t.height*t.scaleY-30,t.hitImg.horizontalCenter=-15*(t.scaleX>0?1:-1),t.hitImg.visible=!0,TimerUtils.instance.listen(r,t,50,egret.getTimer()+50),e&&(FlutterLabelMgr.createFlutterLabel(new egret.Point(t.x,t.y-.5*t.dbModel.height*t.dbModel.scaleY),App.layerMgr.tips_layer,2,"-"+e.Info.attack,{fontName:"hf"}),t.Info.life-=e.Info.attack,t.hpBar.value=t.Info.life/t.Info.maxLife,t.Info.life<=0&&(App.notice.notify(EventConst.BATTLE_MODEL_DEATH,{hurtBody:t,attackBody:e}),App.notice.remove(EventConst.BATTLE_MODEL_DEATH,t.targetDieEvt,t),t._stateMgr.addState(StateHelper.createState(1,[{state:Enum_state.die,time:600}]),!0,!0),DbHelper.destoryDragonBones(t.Info.keyName),t.isDie=!0))},t.prototype.death=function(e){var t=this;t.dbModel&&t.dbModel.animation.play("dead",1)},t.prototype.hit=function(){var e=this;e.dbModel&&e.dbModel.animation.play("attack",1),e.StateMgr.addState(StateHelper.createState(1,[{state:Enum_state.cool,time:e.coolTime}]))},t.prototype.searchNearEnemyUnit=function(e){function t(e,t){var i=t._mModel,a=Math.pow(i.x-r.x,2),s=Math.pow(i.y-r.y,2),l=Math.sqrt(a+s);e>l&&(n=l,o=t)}var r=this,o=null,n=99999;if(1==e.length)return e[0];for(var i=0,a=e;i<a.length;i++){var s=a[i];t(n,s)}return o},t.prototype.initDb=function(){var e=this;e.astar=new AStar2;var t=e.Info;e.scaleX=t.isScale?e.scaleVal:-e.scaleVal,e.hitImg||(e.hitImg=new eui.Image,e.hitImg.visible=!1,e.addChild(e.hitImg)),e.hitImg.source="common_common_battle_wjskl_04_png",e.hitImg.horizontalCenter=0},t.prototype.initHpBar=function(){var e=this;if(!e.hpBar){var t=e._unitKey.split("_");e.hpBar=HpBarPoolMgr.createHpBar(new egret.Point(Math.round(-.5*e.width),-e.dbModel.height-20),e,"player"==t[0])}},t.prototype.update=function(e){var t=this;t.check()},t.prototype.check=function(){var e=this;if(e.dbModel){var t=e._nowPlayerBehaivor[0],r=t._state,o=App.mapMgr.mapMgr.mGrid;if(!e.enemy||"cleanItem"==e.enemy._flag){var n=App.mapMgr.getOtherUnit(e._unitKey);0==n.length?e.enemy=App.mapMgr.getSpecialUnit():e.enemy=e.searchNearEnemyUnit(n)}var i=e.enemy,a=e.enemy._mModel;if(!(a&&a.Info.life<=0)){var s=new egret.Point(e.x,e.y),l=e.attackWidth,p=new egret.Point(a&&a.x||i.x,a&&a.y||i.y),c=e.x-(a&&a.x||i.x)>0?!0:!1,u=function(e,t,r){return Math.pow(e.x-r.x,2)+Math.pow(e.y-r.y,2)>Math.pow(t,2)?!1:!0},h=!1;switch(r){case Enum_state.cool:break;case Enum_state.attack:MTween.remove(e),c?e.scaleX=e.scaleVal:e.scaleX=-e.scaleVal;break;case Enum_state.hurt:MTween.remove(e);break;case Enum_state.idle:if(MTween.remove(e),!o)return void console.error("a星网格还没初始化完成。。。");if(e._lstChecPathkTime){if(e._loopTime-e._lstChecPathkTime<800)return;e._lstChecPathkTime=e._loopTime}else e._lstChecPathkTime=e._loopTime;if(h=u(s,l,p))return MTween.remove(e),void e.StateMgr.addState(StateHelper.createState(1,[{state:Enum_state.attack,time:e.attackTime}],function(){a&&!egret.is(e,"RemoteSoldier")&&a.StateMgr.addState(StateHelper.createState(1,[{state:Enum_state.hurt,time:80,param:e}]),!0)}),!0,!0);var d=Math.ceil(e.x/AppConst.ITEM_NODE_SIZE),f=Math.ceil(e.y/AppConst.ITEM_NODE_SIZE),_=o.getNode(d,f),y=void 0,m=0;a?(y=Math.ceil(a.x/AppConst.ITEM_NODE_SIZE),m=Math.ceil(a.y/AppConst.ITEM_NODE_SIZE)):(y=Math.ceil(i.x/AppConst.ITEM_NODE_SIZE),m=Math.ceil(i.y/AppConst.ITEM_NODE_SIZE));var v=o.getNode(y,m);if(e.astar.findPath(App.mapMgr.mapMgr.mGrid,_,v)){e.astar.floyd(),e.astar.floydPath.shift();var g=e.astar.floydPath;e.runPath(g),e.StateMgr.addState(StateHelper.createState(1,[{state:Enum_state.running,time:-1}]),!0)}else e.idle();break;case Enum_state.running:h=u(s,l,p),h&&(MTween.remove(e),e.StateMgr.addState(StateHelper.createState(1,[{state:Enum_state.attack,time:e.attackTime}],function(){a&&!egret.is(e,"RemoteSoldier")&&a.StateMgr.addState(StateHelper.createState(1,[{state:Enum_state.hurt,time:80,param:e}]),!0)}),!0,!0));break;case Enum_state.die:}}}},t.prototype.runPath=function(e){var t=this;for(new Array;e&&e.length>0;){var r=e.shift(),o=r.x*AppConst.ITEM_NODE_SIZE,n=r.y*AppConst.ITEM_NODE_SIZE,i=o-t.x,a=n-t.y,s=Math.sqrt(i*i+a*a);if(1>s);else{MTween.remove(t);var l=10,p=s*l;t.scaleX=i>0?-t.scaleVal:t.scaleVal;var c=t.x+i,u=t.y+a;MTween.to(t,{x:c,y:u},p,null,function(){t.StateMgr.addState(StateHelper.createState(1,[{state:Enum_state.idle,time:-1}]))},t)}}},t}(BaseStateDbModel);__reflect(BaseLifeDbModel.prototype,"BaseLifeDbModel");var BaseBattleCtrl=function(){function e(){}return e.prototype.initBattle=function(e){App.mapMgr.unitLayer.removeChildren(),App.mapMgr.enterScene(e),App.layerMgr.floor_layer.visible=!0,App.layerMgr.main_layer.visible=!1;var t=AnimationHelper.addEff("battle/fight_start","fight_start",App.layerMgr.floor_layer,420,220,1200,1200);App.layerMgr.floor_layer.addChild(t)},e.prototype.enterBattleView=function(){},e.prototype.exitBattle=function(){App.layerMgr.floor_layer.visible=!1,App.layerMgr.main_layer.visible=!0},e}();__reflect(BaseBattleCtrl.prototype,"BaseBattleCtrl");var BaseView=function(e){function t(){var t=e.call(this)||this;return t}return __extends(t,e),t.prototype.init=function(){var e=this;e.mControl&&(e.mControl.mView=e)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.onOpen=function(e){var t=this;t.onResize(),App.notice.listen(EventConst.RESIZE_EVENT,t.onResize,t)},t.prototype.onClose=function(){var e=this;App.notice.remove(EventConst.RESIZE_EVENT,e.onResize,e)},t.prototype.onResize=function(){var e=AppConst.stage,t=AppConst.width=document.body.clientWidth,r=AppConst.height=document.body.clientHeight,o=r/t;if(.5625>=o&&o>.46)var n=AppConst.scaleMode=egret.StageScaleMode.FIXED_WIDTH;else var n=AppConst.scaleMode=egret.StageScaleMode.SHOW_ALL;e.scaleMode!=n&&(e.scaleMode=n)},t.prototype.closeView=function(){var e=this;App.layerMgr.closeView(e.pid)},t}(eui.Component);__reflect(BaseView.prototype,"BaseView",["ViewInterface"]);var BaseBattleView=function(e){function t(t,r){var o=e.call(this)||this,n=o;return n.ctrl=r,n.viewData=t,n.initView(),o}return __extends(t,e),t.prototype.initView=function(){},t.prototype.onDestory=function(){},t}(egret.Sprite);__reflect(BaseBattleView.prototype,"BaseBattleView");var NoticeHelper=function(){function e(){this.msgMap={},this.invalidMap={},this.invalid=0,this.msgDelayCalls=[],this.havDelay=!1}return e.prototype.addDelayCalls=function(e,t){void 0===t&&(t=null),-1==this.msgDelayCalls.indexOf(e)&&(this.msgDelayCalls.push([e,t]),this.havDelay=!0)},e.prototype.callDelayMsgs=function(){if(this.havDelay){for(var e=this.msgDelayCalls,t=0,r=e.length;r>t;t++){var o=e[t];this.notify(o[0],o[1]),o=null}this.msgDelayCalls=[],this.havDelay=!1}},e.prototype.notify=function(e,t){void 0===t&&(t=null);var r=this.msgMap[e];if(r)for(var o=0,n=r.length;n>o;o++){var i=r[o];i&&(i[0]=t,i[1].apply(i[2],i))}},e.prototype.remove=function(e,t,r){void 0===r&&(r=null);var o=this.msgMap[e];if(o){var n=this.getIndex(t,o,r);-1!=n&&(o[n]=null,this.invalidMap[e]=!0,!this.invalid,this.invalid++)}},e.prototype.listen=function(e,t,r){void 0===r&&(r=null);var o=this.msgMap[e];o||(o=this.msgMap[e]=[]);var n=this.getIndex(t,o,r);n>=0||o.unshift([null,t,r])},e.cleannull=function(){var e=this;if(e.invalid){e.invalid=0;for(var t in e.invalidMap){e.msgMap[t];delete e.invalidMap[t]}}},e.prototype.listenonce=function(e,t,r){void 0===r&&(r=null);var o=this;this.listen(e,function n(i){o.remove(e,n,this),t.apply(r,i)},this)},e.prototype.getIndex=function(e,t,r){for(var o=t.length-1;o>=0;o--){var n=t[o];if(n&&e==n[1]&&(!r||n[2]==r))return o}return-1},e}();__reflect(NoticeHelper.prototype,"NoticeHelper");var ByteArrayMsg=function(){function e(){this._msgBuffer=new egret.ByteArray}return e.prototype.receive=function(e){e.readBytes(this._msgBuffer);var t=this.decode(this._msgBuffer);t&&App.sysNotice.notify(t.key,t.body),0==this._msgBuffer.bytesAvailable&&this._msgBuffer.clear()},e.prototype.send=function(e,t){var r=this.encode(t);r&&(r.position=0,e.writeBytes(r,0,r.bytesAvailable))},e.prototype.decode=function(e){return console.error("decode需要子类重写，根据项目的协议结构解析"),null},e.prototype.encode=function(e){return console.error("encode需要子类重写，根据项目的协议结构解析"),null},e}();__reflect(ByteArrayMsg.prototype,"ByteArrayMsg",["BaseMsg"]);var UTFMsg=function(){function e(){}return e.prototype.receive=function(e){var t=e.readUTF(),r=this.decode(t);r&&App.notice.notify(r.key,r.body)},e.prototype.send=function(e,t){var r=this.encode(t);r&&(e.type=egret.WebSocket.TYPE_STRING,e.writeUTF(r))},e.prototype.decode=function(e){return console.error("decode需要子类重写，根据项目的协议结构解析"),null},e.prototype.encode=function(e){return console.error("encode需要子类重写，根据项目的协议结构解析"),null},e}();__reflect(UTFMsg.prototype,"UTFMsg",["BaseMsg"]);var GameTest=function(e){function t(){var r=e.call(this)||this;return r._cellSize=40,t.instance=r,r.makeGrid(),r.makePlayer(),r}return __extends(t,e),t.prototype.makePlayer=function(){this._player=new egret.Sprite,this._player.touchEnabled=!0,this._player.graphics.beginFill(16711680),this._player.graphics.drawCircle(0,0,5),this._player.graphics.endFill(),this._player.x=50,this._player.y=60,this.addChild(this._player),this._lineShape=new egret.Shape,this.addChild(this._lineShape)},t.prototype.makeGrid=function(){this._gridContent=new egret.DisplayObjectContainer,this._gridContent.touchEnabled=!0,this._gridContent.touchChildren=!1,this._gridContent.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGridClick,this),this.addChild(this._gridContent),this._grid=new Grid(10,10,40);for(var e=0;30>e;e++)this._grid.setWalkable(Math.floor(10*Math.random()),Math.floor(10*Math.random()),!1);this.drawGrid()},t.prototype.drawGrid=function(){this._gridArr=new Array;for(var e=0;e<this._grid.numCols;e++){this._gridArr[e]=[];for(var t=0;t<this._grid.numRows;t++){var r=this._grid.getNode(e,t),o=new egret.Shape;o.graphics.lineStyle(.1),o.graphics.beginFill(this.getColor(r)),o.graphics.drawRect(0,0,this._cellSize,this._cellSize),o.graphics.endFill(),o.x=e*this._cellSize,o.y=t*this._cellSize,this._gridContent.addChild(o),this._gridArr[e][t]=o}}},t.prototype.getColor=function(e){return e.walkable?13421772:0},t.prototype.onGridClick=function(e){var t=Math.floor(e.stageX/this._cellSize),r=Math.floor(e.stageY/this._cellSize),o=this._grid.getNode(t,r),n=Math.floor(this._player.x/this._cellSize),i=Math.floor(this._player.y/this._cellSize),a=this._grid.getNode(n,i);if(0==o.walkable){var s=this._grid.findReplacer(a,o);s&&(t=s.x,r=s.y)}this.findPath()},t.prototype.findPath=function(){egret.getTimer()},t.prototype.onEnterFrame=function(e){if(0==this._path.length)return void this.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this);var t=this._path[this._index].x*this._cellSize+this._cellSize/2,r=this._path[this._index].y*this._cellSize+this._cellSize/2,o=t-this._player.x,n=r-this._player.y,i=Math.sqrt(o*o+n*n);1>i?(this._index++,this._index>=this._path.length&&this.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this)):(this._player.x+=.5*o,this._player.y+=.5*n)},t}(egret.DisplayObjectContainer);__reflect(GameTest.prototype,"GameTest");var TestView=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.init=function(){e.prototype.init.call(this)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.onOpen=function(t){e.prototype.onOpen.call(this,t);var r=this;App.mapMgr.enterScene(101),App.notice.listen(EventConst.MAP_LOAD_COMPLATE,function(){var e=[],t=StateHelper.createState(1,[{state:Enum_state.idle,time:5e3}]);e.push(t);var r=[],o=StateHelper.createState(1,[{state:Enum_state.idle,time:5e3}]);r.push(o);var n=[],i=StateHelper.createState(1,[{state:Enum_state.idle,time:5e3}]);n.push(i);var a=[],s=StateHelper.createState(1,[{state:Enum_state.idle,time:5e3}]);a.push(s);var l=[],p=StateHelper.createState(1,[{state:Enum_state.idle,time:5e3}]);l.push(p);var c=new BaseDbHero;c._unitKey="player_1",c.x=160,c.y=360;var u=BaseState.create({isScale:!1,attack:15,maxLife:100,life:100,modelId:1,keyName:"daqiao",png:"wjactor_daqiao_tex.png",json:"wjactor_daqiao_tex.json",dbJson:"wjactor_daqiao_ske.json"},c,l);App.mapMgr.addUnit(u,c._unitKey);var h=new RemoteDbSoldier;h._unitKey="enemy_2",h.x=560,h.y=500;var d=BaseState.create({isScale:!0,attack:5,maxLife:100,life:100,modelId:2,keyName:"gongbing",png:"wjactor_TYgongjiang_1_tex.png",json:"wjactor_TYgongjiang_1_tex.json",dbJson:"wjactor_TYgongjiang_1_ske.json"},h,n);App.mapMgr.addUnit(d,h._unitKey);var f=new RemoteDbSoldier;f._unitKey="enemy_3",f.x=560,f.y=320;var _=BaseState.create({isScale:!0,attack:5,maxLife:100,life:100,modelId:2,keyName:"gongbing",png:"wjactor_TYgongjiang_1_tex.png",json:"wjactor_TYgongjiang_1_tex.json",dbJson:"wjactor_TYgongjiang_1_ske.json"},f,a);App.mapMgr.addUnit(_,f._unitKey)},r)},t.prototype.onClose=function(){e.prototype.onClose.call(this)},t}(BaseView);__reflect(TestView.prototype,"TestView");var App=function(){function e(){}return e.init=function(e){var t=this;t.layerMgr=new LayerManager,t.layerMgr.init(e),t.mapMgr=new MapScene,t.notice=new NoticeHelper,t.sysNotice=new NoticeHelper,t.resMgr=new RESManager,t.keyBoardMgr=new KeyBoardHelper,t.fontMgr=new FontHelper,t.batterMgr=new BattleMgr,t.batterMgr.initEventListner(),AnimationHelper.instance=new AnimationHelper},e}();__reflect(App.prototype,"App");var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.onProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var BattleMgr=function(){function e(){}return e.prototype.initEventListner=function(){var e=this;App.notice.listen(EventConst.BATTLE_START,e.createBattleCtrl,e),App.notice.listen(EventConst.BATTLE_MODEL_DEATH,function(e){var t=e.hurtBody,r=e.attackBody;RightKillTipsMgr.createTips(r,t),CenterKillTipsMgr.createTips(r,t)},e)},e.prototype.createBattleCtrl=function(e){var t=this;t._battleCtrl||(t._battleCtrl=new NormalBattleCtrl,t._battleCtrl.initBattleData(null))},e.prototype.exitBattle=function(){var e=this,t=e._battleCtrl;t&&t.exitBattleView(),e._battleCtrl=null},e}();__reflect(BattleMgr.prototype,"BattleMgr");var BattleCard=function(e){function t(){var t=e.call(this)||this;return t.skinName="resource/skin/battle/SkinBattleCard.exml",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.initView=function(e){var t=this;t.tId=e,t.head.source="head_json.tb_tx_diaochan",t.type.source="tb_qb_png",t.cost.text="150"},t.prototype.destoryItem=function(){var e=this;e.tId=-1,e.head.source=null,e.type.source=null,e.cost.text="",t.pool.push(e)},t.createCard=function(e){var r=this,o=r.pool.length>0?r.pool.shift():new t;return o.initView(e),o},t.pool=[],t}(eui.Component);__reflect(BattleCard.prototype,"BattleCard");var CenterKillTips=function(e){function t(){var t=e.call(this)||this;return t.skinName="resource/skin/battle/SkinCenterKillTips.exml",t}return __extends(t,e),t.prototype.playTween=function(e,t,r){function o(){n.y=40,n.alpha=1,MTween.to(n,{y:-n.height,alpha:0},450,null,function(){n.disposeTween()})}var n=this,i=(AppConst.ORG_WIDTH-n.width)/2;n.y=-n.height,n.alpha=0,n.x=i,MTween.to(n,{y:40,alpha:1},450,null,function(){o()},n,null,null,450)},t.prototype.disposeTween=function(){var e=this;e.parent&&e.parent.removeChild(e),CenterKillTipsMgr.recyicItem(e)},t}(eui.Component);__reflect(CenterKillTips.prototype,"CenterKillTips");var CenterKillTipsMgr=function(){function e(){}return e.createTips=function(e,t){function r(){TimerUtils.instance.remove(r,o),o.checkQuene2Load()}var o=this;if(-1!=o._lstCreateTime){var n=egret.getTimer()-o._lstCreateTime;if(n<o._createCoolTime)return o.waitTipsQuene.push([e,t]),void TimerUtils.instance.listen(r,o,o._createCoolTime-n)}o._lstCreateTime=egret.getTimer();e.Info,t.Info;if(!e||!t)return void console.error("数据不存在，请检查 。");if(o.nowTipsQuene.length>=o._maxLifeNum)return console.error("当前显示的数量已经是最大显示数量，加入待显示列表中。"),void o.waitTipsQuene.push([e,t]);var i=null;i=o.pool.length>0?o.pool.shift():new CenterKillTips,i.playTween(1,1,!0),App.layerMgr.tips_layer.addChild(i),o.nowTipsQuene.push(i),o.checkQuene2Load()},e.checkQuene2Load=function(){var e=this;if(e.nowTipsQuene.length<e._maxLifeNum&&e.waitTipsQuene.length>0){var t=e.waitTipsQuene.shift();if(!t)return;e.createTips(t[0],t[1])}},e.recyicItem=function(e){var t=this;if(!e)return void console.error("请检查，该项数据异常.");var r=t.nowTipsQuene.indexOf(e);if(-1!=r&&t.nowTipsQuene.splice(r,1),t.pool.push(e),t.waitTipsQuene.length>0){var o=t.waitTipsQuene.shift();t.createTips(o[0],o[1])}},e.pool=[],e.waitTipsQuene=[],e.nowTipsQuene=[],e._maxLifeNum=1,e._tipsTime=1500,e._lstCreateTime=-1,e._createCoolTime=200,e}();__reflect(CenterKillTipsMgr.prototype,"CenterKillTipsMgr");var RightKillTips=function(e){function t(){var t=e.call(this)||this;return t.skinName="resource/skin/battle/SkinRightKillTips.exml",t}return __extends(t,e),t.prototype.playTween=function(e,t,r){function o(){n.x=1280-n.width,n.alpha=1,MTween.to(n,{x:1280+n.width,alpha:1},450,null,function(){n.x=1280+n.width,n.disposeTween()},n)}var n=this;n.x=1280+n.width,n.alpha=0,MTween.to(n,{x:1280-n.width,alpha:1},450,null,function(){o()},n,null,null,1500)},t.prototype.disposeTween=function(){var e=this;e.parent&&e.parent.removeChild(e),RightKillTipsMgr.recyicItem(e)},t}(eui.Component);__reflect(RightKillTips.prototype,"RightKillTips");var RightKillTipsMgr=function(){function e(){}return e.createTips=function(e,t){function r(){TimerUtils.instance.remove(r,o),o.checkQuene2Load()}var o=this;if(-1!=o._lstCreateTime){var n=egret.getTimer()-o._lstCreateTime;if(n<o._createCoolTime)return o.waitTipsQuene.push([e,t]),void TimerUtils.instance.listen(r,o,o._createCoolTime-n)}o._lstCreateTime=egret.getTimer();e.Info,t.Info;if(!e||!t)return void console.error("数据不存在，请检查 。");if(o.nowTipsQuene.length>=o._maxLifeNum)return console.error("当前显示的数量已经是最大显示数量，加入待显示列表中。"),void o.waitTipsQuene.push([e,t]);var i=null;i=o.pool.length>0?o.pool.shift():new RightKillTips,i.playTween(1,1,!0),App.layerMgr.tips_layer.addChild(i),o.nowTipsQuene.push(i),o.initLayout(),o.checkQuene2Load()},e.checkQuene2Load=function(){var e=this;if(e.nowTipsQuene.length<e._maxLifeNum&&e.waitTipsQuene.length>0){var t=e.waitTipsQuene.shift();if(!t)return;e.createTips(t[0],t[1])}},e.initLayout=function(){for(var e=this,t=e.nowTipsQuene.length-1,r=t;r>=0;r--){var o=e.nowTipsQuene[r];if(o){var n=t-r;o.y=580-95*n}}},e.recyicItem=function(e){var t=this;if(!e)return void console.error("请检查，该项数据异常.");var r=t.nowTipsQuene.indexOf(e);if(-1!=r&&t.nowTipsQuene.splice(r,1),t.pool.push(e),t.waitTipsQuene.length>0){var o=t.waitTipsQuene.shift();
t.createTips(o[0],o[1])}},e.pool=[],e.waitTipsQuene=[],e.nowTipsQuene=[],e._maxLifeNum=5,e._tipsTime=1500,e._lstCreateTime=-1,e._createCoolTime=200,e}();__reflect(RightKillTipsMgr.prototype,"RightKillTipsMgr");var NormalBattleCtrl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.initBattleData=function(e){var t=this;t._mView=new NormalBattleView(e,t)},t.prototype.enterBattleView=function(){var e=this;e.initBattle(102)},t.prototype.exitBattleView=function(){var e=this;e._mView.onDestory(),e.exitBattle()},t}(BaseBattleCtrl);__reflect(NormalBattleCtrl.prototype,"NormalBattleCtrl");var NormalBattleView=function(e){function t(t,r){return e.call(this,t,r)||this}return __extends(t,e),t.prototype.initView=function(){var e=this;e._bottomGp=new eui.Group,e._bottomGp.width=AppConst.ORG_WIDTH,e._bottomGp.height=120,e._bottomGp.x=0,e._bottomGp.y=AppConst.ORG_HEIGHT-120,App.layerMgr.floor_layer.addChild(e),e.addChild(e._bottomGp);var t=new eui.HorizontalLayout;t.verticalAlign=egret.VerticalAlign.MIDDLE,t.gap=15,e._bottomGp.layout=t;for(var r=4;r>0;r--){var o=BattleCard.createCard(3);e._bottomGp.addChild(o)}e.ctrl.enterBattleView(),e.initEvt()},t.prototype.onDestory=function(){var e=this;if(e.cleanEvt(),e._bottomGp){for(var t=e._bottomGp.numChildren,r=t;r>0;r--){var o=e._bottomGp.removeChildAt(0);o.destoryItem()}e._bottomGp.parent.removeChild(e._bottomGp)}e.parent&&e.parent.removeChild(e),e.viewData=null,e._bottomGp=null},t.prototype.createdLifeObj=function(){var e=[],t=StateHelper.createState(1,[{state:Enum_state.idle,time:-1}]);e.push(t);var r=new BaseDbHero;r._unitKey="player_1",r.x=160,r.y=360;var o=BaseState.create({isScale:!1,attack:15,maxLife:150,life:150,modelId:1,keyName:"daqiao",png:"wjactor_daqiao_tex.png",json:"wjactor_daqiao_tex.json",dbJson:"wjactor_daqiao_ske.json"},r,e);App.mapMgr.addUnit(o,r._unitKey);var n=[],i=StateHelper.createState(1,[{state:Enum_state.idle,time:-1}]);n.push(i);var a=new BaseDbHero;a._unitKey="enemy_1",a.x=1e3,a.y=300;var s=BaseState.create({isScale:!0,attack:15,maxLife:100,life:100,modelId:3,keyName:"caocao",png:"wjactor_caocao_tex.png",json:"wjactor_caocao_tex.json",dbJson:"wjactor_caocao_ske.json"},a,n);App.mapMgr.addUnit(s,a._unitKey)},t.prototype.cardGroupClick=function(e){var t=this,r=e.target;r instanceof BattleCard&&t.createdLifeObj()},t.prototype.initEvt=function(){var e=this;e._bottomGp.addEventListener(egret.TouchEvent.TOUCH_TAP,e.cardGroupClick,e)},t.prototype.cleanEvt=function(){var e=this;e._bottomGp.removeEventListener(egret.TouchEvent.TOUCH_TAP,e.cardGroupClick,e)},t}(BaseBattleView);__reflect(NormalBattleView.prototype,"NormalBattleView");var FkBattleCard=function(e){function t(t){var r=e.call(this)||this;return r}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(eui.Component);__reflect(FkBattleCard.prototype,"FkBattleCard");var Main=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var t=egret.Capabilities;if(t.isMobile){var r=t.os;"Android"==r?egret.TextField.default_fontFamily="Droid Sans Fallback":"iOS"==r||"Mac OS"==r?egret.TextField.default_fontFamily="Heiti SC":egret.TextField.default_fontFamily="微软雅黑"}else egret.TextField.default_fontFamily="微软雅黑";var o=this;egret.TextField.default_size=22,AppConst.main=o,AppConst.stage=egret.MainContext.instance.stage,AppConst.width=document.body.clientWidth,AppConst.height=document.body.clientHeight,o.stage.addEventListener(egret.Event.RESIZE,o.onResized,o),RES.setMaxLoadingThread(5);var n=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",n),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),egret.TextField.default_fontFamily="hddFond",RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},t.prototype.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},t.prototype.onResourceLoadError=function(e){this.onResourceLoadComplete(e)},t.prototype.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},t.prototype.onResourceProgress=function(e){"preload"==e.groupName},t.prototype.onResourceLoadComplete=function(e){"preload"==e.groupName&&(RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.runGame())},t.prototype.loadExml=function(){var e=this;RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var t="resource/default.thm.json",r=new eui.Theme(t,this.stage);r.addEventListener(eui.UIEvent.COMPLETE,function o(){r.removeEventListener(eui.UIEvent.COMPLETE,o,e),e.createGameScene()},e)},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(r){switch(r.label){case 0:return e=this,e.loadExml(),console.error("create game scene!"),[4,platform.login()];case 1:return r.sent(),[4,platform.getUserInfo()];case 2:return t=r.sent(),console.log(t),[2]}})})},t.prototype.frameLogic=function(){var e=egret.getTimer(),t=this,r=33;t._timer.run(e),App.mapMgr.update(r),MTween.instance.update(r)},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,r){var o=new eui.Theme("resource/default.thm.json",e.stage);o.addEventListener(eui.UIEvent.COMPLETE,function(){t()},e)})},t.cleanLoadView=function(){window.diposeLoadView()},t.prototype.createGameScene=function(){var e=this;e._timer=TimerUtils.instance,e.addEventListener(egret.Event.ENTER_FRAME,e.frameLogic,e),App.init(e),App.layerMgr.initView(),DbHelper.init(),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,function r(o){if("gamecfg"==o.groupName){RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,r,e);var n=RES.getRes("config_json");Config.initMapping(),Config.initConfig(n),t.cleanLoadView();var i=App.wsMgr=new Socket;i.initServer("127.0.0.1",8181,new ByteArrayMsgByProtobuf),i.connect(),App.notice.listen(SocketConst.SOCKET_CONNECT,function(){console.error("发送消息了哦。");var e={};e.key="simple.user_login_c2s",e.body={accid:888,tstamp:999,ticket:"yangsong"},App.wsMgr.send(e)},e)}},this),RES.loadGroup("gamecfg")},t.prototype.onResized=function(){console.error("-------------Resize事件监听回调-------------"),App.notice.notify(EventConst.RESIZE_EVENT),console.error("-------------Resize事件监听回调-------------")},t}(eui.UILayer);__reflect(Main.prototype,"Main");var FkFlutterLabel=function(e){function t(t,r,o,n){var i=e.call(this)||this,a=i;return a.type=r,1==r?(a._jnSprite=new egret.Bitmap,a.addChild(a._jnSprite)):2==r?(a._hpSprite=new egret.BitmapText,a.addChild(a._hpSprite)):3==r&&(a._textTextField=new egret.TextField,a.addChild(a._textTextField)),a.initFlutterLabel(t,r,o,n),i}return __extends(t,e),t.prototype.initFlutterLabel=function(e,t,r,o){var n=this;if(1==t)eui.getAssets(r,function(e){return egret.is(e,"egret.Texture")?void(n._jnSprite.texture=e):void console.error("解析资源--结果：并不是纹理资源>>>请检查")});else if(2==t)App.fontMgr.loadBitmapLabelFont(o.fontName,function(e){n._hpSprite.font=e,n._hpSprite.text=r},n);else if(3==t){var i=15922164,a=26;o&&(o.textColor?i=o.textColor:null,o.textSize?a=o.textSize:null),n._textTextField.textColor=i,n._textTextField.size=a,n._textTextField.text=r}n.x=e.x,n.y=e.y,n.tweenAnimation()},t.prototype.tweenAnimation=function(){var e=this,t=e.type;(1==t||2==t)&&(e.alpha=1,MTween.to(e,{alpha:0,y:e.y-30},1e3,null,function(){FlutterLabelMgr.disposeFlutterLabel(e)},e))},t.prototype.dispose=function(){var e=this;e.parent&&e.parent.removeChild(e),1==e.type?e._jnSprite.$bitmapData=e._jnSprite.texture=null:2==e.type?e._hpSprite.text=e._hpSprite.font=null:3==e.type&&(e._textTextField.text="")},t}(egret.Sprite);__reflect(FkFlutterLabel.prototype,"FkFlutterLabel");var FlutterLabelMgr=function(){function e(){}return e.createFlutterLabel=function(e,t,r,o,n){var i=this,a=i.pool[r],s=a.length>0?a.shift():new FkFlutterLabel(e,r,o,n);t.addChild(s)},e.disposeFlutterLabel=function(e){var t=this;e.dispose(),t.pool[e.type]=e},e.pool={1:[],2:[],3:[]},e}();__reflect(FlutterLabelMgr.prototype,"FlutterLabelMgr");var FkProgressBar=function(e){function t(t){var r=e.call(this)||this;return t&&(r.skinName=t),r}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this);var t=this;return t.imgBgBar&&t.imgCountBar?(t._imgBgBarSouce&&(t.imgBgBar.source=t._imgBgBarSouce),void(t._imgCountBarSource&&(t.imgCountBar.source=t._imgCountBarSource,t._value?t.imgCountBar.width=t._value*t.imgBgBar.width:t.imgCountBar.width=0))):void console.error("皮肤声明有问题哦！")},Object.defineProperty(t.prototype,"bg",{get:function(){var e=this;return e._imgBgBarSouce},set:function(e){var t=this;t._imgBgBarSouce=e,t.imgBgBar&&(t.imgBgBar.source=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bar",{set:function(e){var t=this;t._imgCountBarSource=e,t.imgCountBar&&(t.imgCountBar.source=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){var e=this;return e._value},set:function(e){var t=this;t._value=e,t.imgCountBar&&(MTween.remove(t.imgCountBar),MTween.to(t.imgCountBar,{width:e*t.imgBgBar.width},100))},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){var e=this;e._value=1,e.parent&&e.parent.removeChild(e)},t}(eui.Component);__reflect(FkProgressBar.prototype,"FkProgressBar");var HpBarPoolMgr=function(){function e(){}return e.createHpBar=function(e,t,r){void 0===r&&(r=!0);var o=this,n=o.pool.length>0?o.pool.shift():new FkProgressBar("resource/skin/componments/SkinHpBar.exml");return n.x=e.x,n.y=e.y,n.value=1,t.addChild(n),r||(n.bar="battle_tips_json.img_hp_bar_r"),n},e.dispose=function(e){var t=this;e.dispose(),t.pool.push(e)},e.pool=[],e}();__reflect(HpBarPoolMgr.prototype,"HpBarPoolMgr");var MainBuildingButton=function(e){function t(){var t=e.call(this)||this;return t._titleIcon="",t._offsetHor=0,t._offsetP=0,t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this);var t=this;t.titleicon.source=t._titleIcon},Object.defineProperty(t.prototype,"title",{get:function(){var e=this;return e._titleIcon},set:function(e){var t=this;t._titleIcon=e,t.titleicon&&(t.titleicon.source=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"offLeft",{get:function(){var e=this;return e._offsetHor},set:function(e){var t=this;t._offsetHor=e,t.titleicon&&(t.titleicon.left=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"offTop",{set:function(e){var t=this;t._offsetP=e,t.titleicon&&(t.titleicon.top=e)},enumerable:!0,configurable:!0}),t}(FkComButton);__reflect(MainBuildingButton.prototype,"MainBuildingButton");var MainCtrl=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(BaseControl);__reflect(MainCtrl.prototype,"MainCtrl");var MainView=function(e){function t(){var t=e.call(this)||this,r=t;return r.skinName="resource/skin/main/SkinMainView.exml",r.mControl=new MainCtrl,r.init(),t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.onOpen=function(t){e.prototype.onOpen.call(this,t);var r=this;r.addEventListener(egret.TouchEvent.TOUCH_TAP,r.clickEvt,r),LoaderHelper.instance().loader(r.bg,"resource/ui/main/bg.png")},t.prototype.onClose=function(){e.prototype.onClose.call(this);var t=this;t.removeEventListener(egret.TouchEvent.TOUCH_TAP,t.clickEvt,t),LoaderHelper.instance().reduceImg(t.bg)},t.prototype.clickEvt=function(e){var t=e.target;t instanceof MainBuildingButton&&App.notice.notify(EventConst.BATTLE_START,null)},t}(BaseView);__reflect(MainView.prototype,"MainView");var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var PoolItemState;!function(e){e[e.idle=1]="idle",e[e.busy=2]="busy"}(PoolItemState||(PoolItemState={}));var BaseState=function(){function e(){}return e.create=function(t,r,o){var n=this,i=null;return i=n.pool&&n.pool.length>0?n.pool.shift():new e,i._mModel=r,i._mModel.StateMgr=i,i._mModel.Info=t,i._stateQuene=o,i._mStartTime=i._mTimer=egret.getTimer(),i._flag="initItem",i},e.prototype.update=function(e){var t=this,r=t._flag;if("stopRender"!=r){if("stopRemove"==r)return void t.checkClean();if("initItem"==r)return t.checkAction(),void(t._flag="decodeAction");if(!t._mNowState)return void console.error("当前并不存在状态 是否没加flag移除");var o=t._mNowState;t._mStartTime+=e,o._startTime||(o._startTime=t._mStartTime);var n=t._mStartTime-o._startTime;"nextState"==t._flag||-1!=o._loopTime&&n>=o._loopTime?("nextState"==t._flag&&(t._flag="decodeAction"),t._mModel.isSpecial&&(t._mModel.isSpecial=!1),t.checkAction()):t._mModel.updateTime(e)}},e.prototype.checkAction=function(){var e=this,t=e._mNowState;if(t&&t._beforeCall&&t._beforeCall.call(e._mModel),e._stateQuene.length>0){e._mNowState=e._stateQuene.shift();var r=null;t&&t._afterCall&&(r=t._afterCall),e._mModel._startDecodeTime=e._mStartTime,e._mModel.decodeAction(e._mNowState,r)}else e._mModel.isDie?(App.mapMgr.removeUnit(e._mModel._unitKey,!1),e._flag="stopRemove",e.checkClean()):e.addState(StateHelper.createState(1,[{state:Enum_state.idle,time:-1}]))},e.prototype.addState=function(e,t,r){void 0===t&&(t=!1),void 0===r&&(r=!1);var o=this;o._mModel&&o._mModel.isDie||!o._mModel||(r&&(o._stateQuene=[]),t&&!o._mModel.isSpecial?(o._flag="nextState",o._stateQuene.unshift(e)):o._stateQuene.push(e))},e.prototype.checkClean=function(){var t=this;"stopRemove"==t._flag?(t.clean(),e.pool.push(t)):console.error("当前的标示并不是清楚，继续等待:",t._flag)},e.prototype.clean=function(){var e=this;e._mModel=null,e._mNowState=null,e._mTimer=-1,e._stateQuene=[],e._flag="cleanItem"},e.pool=[],e}();__reflect(BaseState.prototype,"BaseState");var ItemState=function(){function e(){this._type=1}return e}();__reflect(ItemState.prototype,"ItemState");var ItemBehavior=function(){function e(){}return e}();__reflect(ItemBehavior.prototype,"ItemBehavior");var BaseArrow=function(e){function t(){var t=e.call(this)||this;return t._flag="idle",t._lstTop=-1,t}return __extends(t,e),t.create=function(e,r,o,n,i){void 0===i&&(i=Enum_flyType.auto);var a=this,s=a.pool.length>0?a.pool.shift():new t;return s.scaleX=s.scaleY=.3,s._type=i,s._parent=o,s._unitKey=o._unitKey+"_"+r,s._enemy=n,s._keyName=e,s.initItem(),s},t.prototype.initItem=function(){var e=this;RES.getResByUrl(e._keyName,e.loadCallBack,e)},t.prototype.recoveryItem=function(){var e=this;e._parent=null,e._enemy=null,e._type=-1,e._lstTop=-1,e._flag="idle",e._bitmap.texture=null,App.mapMgr.removeUnit(e._unitKey,!0),e._unitKey="",t.pool.push(e)},t.prototype.loadCallBack=function(e,t){var r=this;r._bitmap=new egret.Bitmap(e),r.addChild(r._bitmap),r.shutTarget()},t.prototype.hurtEnemy=function(){var e=this;egret.is(e._enemy,"BaseLifeModel")&&!egret.is(e._enemy,"BaseLifeDbModel")&&e._enemy.StateMgr.addState(StateHelper.createState(1,[{state:Enum_state.hurt,time:80,param:e._parent}]),!0)},t.prototype.besierRun=function(e,t,r){function o(e){if(p+=.02,p>1)n.rotation=0,n.visible=!1,n._flag="idle",n.hurtEnemy();else{var t=1e-10*s,r=MathUtil.bezier(c,p);MTween.to(n,{x:r[0],y:r[1]},t,null,function(){o(r)},n,function(){p>.5?n.rotation=0+90*(p-.5)*2*i:n.rotation=-80*i+80*p*2*i,n._lstTop=n.y},n)}}var n=this,i=(r?-1:1)*Math.abs(n.scaleX),a=r?t:e,s=Math.abs(t[0]-e[0]),l=[a[0]+s/2,e[1]-350],p=0,c=[e,l,t];n._flag="busy",n.visible=!0,o(e)},t.prototype.lineRun=function(e,t,r,o){var n=this,i=(e.y>t.y?!0:!1,(o?-1:1)*Math.abs(n.scaleX));n.rotation=0,n._flag="busy",n.visible=!0,n.x=e[0],n.y=e[1],n.scaleX=i,MTween.to(n,{x:t[0],y:t[1]},2*r,null,function(){n.rotation=0,n._flag="idle",n.visible=!1,n.hurtEnemy()},n)},t.prototype.shutTarget=function(){var e=this,t=[e._enemy.x-(e.scaleX>0?1:-1)*e._enemy.width*Math.abs(e._enemy.scaleX)/2,e._enemy.y-e._enemy.height*Math.abs(e._enemy.scaleY)/2],r=[e._parent.x,e._parent.y-e._parent.height*Math.abs(e._parent.scaleY)/2],o=r[0]>t[0],n=Math.abs(t[0]-r[0]);e._type==Enum_flyType.parabola?e.besierRun(r,t,o):e._type==Enum_flyType.straight?e.lineRun(r,t,n,o):e._type==Enum_flyType.auto&&(n>300?e.besierRun(r,t,o):e.lineRun(r,t,n,o))},t.prototype.getFlag=function(){var e=this;return e._flag},t.prototype.setEnemy=function(e){var t=this;t._enemy=e,t.shutTarget()},t.pool=[],t}(egret.Sprite);__reflect(BaseArrow.prototype,"BaseArrow");var MissileHelper=function(){function e(){this.arrowItemList=[],this.maxLifeNum=1,this.resKey="",this.flyType=-1}return e.createArrowHelper=function(t,r,o,n){var i=this,a=i.pool.length>0?i.pool.shift():new e;return a.resKey=t,a.flyType=n?n:Enum_flyType.parabola,a.maxLifeNum=o,a._parent=r,a},e.prototype.dispose=function(){for(var t=this,r=0,o=t.arrowItemList;r<o.length;r++){var n=o[r];n.recoveryItem()}ArrayUitls.cleannull(t.arrowItemList),t._parent=null,t.maxLifeNum=1,t.resKey="",t.flyType=-1,e.pool.push(t)},e.prototype.shutTarget=function(e){var t=this;{if(!(t.arrowItemList.length>=t.maxLifeNum)){var r="resource/ui/"+t.resKey,o="arrow_"+t.arrowItemList.length,n=BaseArrow.create(r,o,t._parent,e,t.flyType);return t.arrowItemList.push(n),App.mapMgr.addUnit(n,n._unitKey,!0),n}for(var i=0,a=t.arrowItemList;i<a.length;i++){var s=a[i];if("busy"!=s.getFlag()){s.setEnemy(e);break}}}},e.pool=[],e}();__reflect(MissileHelper.prototype,"MissileHelper");var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,r,o){function n(e){t.call(o,e)}function i(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),r.call(o))}"undefined"!=typeof generateEUI?egret.callLater(function(){t.call(o,generateEUI)},this):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),RES.getResByUrl(e,n,this,RES.ResourceItem.TYPE_TEXT))},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var Config=function(){function e(){}return e.initMapping=function(){var e=this.mapCFG;e.hero="HERO_CONFIG",e.skill="SKILL_CONFIG"},e.makeConfig=function(){var e=this;if(e.SKILL_CONFIG)for(var t in e.SKILL_CONFIG){var r=e.SKILL_CONFIG[t];r.effect=JSON.parse(r.effect)}},e.setResConfig=function(){var t=this.mapCFG;for(var r in t){var o=t[r],n=RES.getRes(r+"_json");e[o]=n,RES.destroyRes(r+"_json")}this.mapCFG=null,RES.destroyRes("config_yq")},e.initConfig=function(t){var r=this.mapCFG;for(var o in t){var n=r[o];n&&(e[n]=t[o])}this.makeConfig(),this.mapCFG=null},e.mapCFG={},e}();__reflect(Config.prototype,"Config");var AppConst=function(){function e(){}return e.ISDEBUG=!1,e.ORG_WIDTH=1280,e.ORG_HEIGHT=720,e.ITEM_NODE_SIZE=50,e.DEBUG_SHOT_BALL="http://192.168.6.156/ball_server/shot.php",e.DEBUG_LIST_INFO="http://192.168.6.156/ball_server/record.php",e.DEBUG_PROTECT_BALL="http://192.168.6.156/ball_server/keeper.php",e.SHOT_BALL="http://dev.qipailele.com/ball_server/shot.php",e.LIST_INFO="http://dev.qipailele.com/ball_server/record.php",e.PROTECT_BALL="http://dev.qipailele.com/ball_server/keeper.php",e}();__reflect(AppConst.prototype,"AppConst");var Enum_part;!function(e){e[e.BODY=1]="BODY",e[e.WING=2]="WING",e[e.WEAPON=3]="WEAPON",e[e.MOUNTS=4]="MOUNTS"}(Enum_part||(Enum_part={}));var Enum_flyType;!function(e){e[e.parabola=1]="parabola",e[e.straight=2]="straight",e[e.auto=3]="auto"}(Enum_flyType||(Enum_flyType={}));var Enum_state;!function(e){e[e.idle=0]="idle",e[e.attack=1]="attack",e[e.running=2]="running",e[e.hurt=3]="hurt",e[e.die=4]="die",e[e.cool=5]="cool",e[e.skill=6]="skill"}(Enum_state||(Enum_state={}));var Enum_skill;!function(e){e[e.Chanting=1]="Chanting",e[e.Attack=2]="Attack",e[e.Buff=3]="Buff"}(Enum_skill||(Enum_skill={}));var BaseBuilding=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(BaseStateModel);__reflect(BaseBuilding.prototype,"BaseBuilding");var BaseDbHero=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initDb=function(){var t=this,r=t.Info;DbHelper.loadDragonBones(r.modelId,r.keyName,r.png,r.json,r.dbJson,function(e){t.dbModel=e,t.scaleX=t.scaleY=t.scaleVal,t.addChildAt(e,0),t.attackWidth=t.dbModel.width*Math.abs(t.scaleX),t.initHpBar()}),e.prototype.initDb.call(this)},t.prototype.skill=function(e){function t(){if(a instanceof Array){var e=a.shift();if(e){var o=r.scaleX>0?-1:1,n=e.type;if(n==Enum_skill.Chanting){var s=AnimationHelper.addEff(e.key,e.actName,r.parent,r.x+1*o,r.y,e.playTime,e.loopTime,!1,t,r);s.scaleX=e.scaleX,s.scaleY=e.scaleY,r.parent.addChild(s)}else{var l=i.range;if(-1==l){var p=r.x+1*o;2==n&&(p=r.x-60*o);var s=AnimationHelper.addEff(e.key,e.actName,r.parent,p,r.y,e.playTime,e.loopTime,!1,t,r);s.scaleX=e.scaleX,s.scaleY=e.scaleY,r.parent.addChild(s)}else for(var p=r.x+1*o,c=App.mapMgr.getRangeTargetList(r._unitKey,i.range,1),u=0,h=c;u<h.length;u++){var d=h[u],f=d._mModel||d,s=AnimationHelper.addEff(e.key,e.actName,f.parent,p,f.y,e.playTime,e.loopTime,!1,t,r);f.parent.addChild(s)}}}}}var r=this;r.dbModel&&r.dbModel.animation.play("skill_1",1);var o=1,n=Config.HERO_CONFIG[o].skill,i=Config.SKILL_CONFIG[n],a=i.effect.concat();FlutterLabelMgr.createFlutterLabel(new egret.Point(r.x,r.y-r.dbModel.height*r.dbModel.scaleY*.5),App.layerMgr.tips_layer,1,"skill_name_json.skillname_"+n),t()},t}(BaseLifeDbModel);__reflect(BaseDbHero.prototype,"BaseDbHero");var BaseHero=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.hit=function(){var e=this,t=e.partMap;for(var r in t){var o=t[r];if(o){e.Info.isScale;o.setActName("Skill1");var n=AnimationHelper.addEff("RoleEffect","Skill1",e,0,-70,1400,1400,!1);e.addChild(n)}}},t.prototype.initPart=function(){var t=this;e.prototype.initPart.call(this);var r=t.Info;if(r.mount&&t._loadCount++,r.weapon&&t._loadCount++,r.body)if(r.fashion);else{var o=t.partMap[Enum_part.BODY]=AnimationItem.create();1==r.type?o.initAniItem("TestRole",t,"Idle",t.loadComplate,t):2==r.type&&o.initAniItem("Enemy",t,"Idle",t.loadComplate,t),t._loadCount++,t.addChild(o)}r.wing&&t._loadCount++},t}(BaseLifeModel);__reflect(BaseHero.prototype,"BaseHero");var RemoteDbSoldier=function(e){function t(){var t=e.call(this)||this,r=t;return r.attackTime=450,r.coolTime=500,t}return __extends(t,e),t.prototype.hit=function(){function t(e){r.arrowHelper.shutTarget(r.enemy._mModel||r.enemy),r.dbModel.removeEvent(dragonBones.EventObject.FRAME_EVENT,t,r)}var r=this;e.prototype.hit.call(this),r.dbModel.addEvent(dragonBones.EventObject.FRAME_EVENT,t,r)},t.prototype.death=function(e){var t=this;t.dbModel&&t.dbModel.animation.play("dead",1),t.arrowHelper.dispose()},t.prototype.initDb=function(){var t=this,r=t.Info;DbHelper.loadDragonBones(r.modelId,r.keyName,r.png,r.json,r.dbJson,function(e){t.dbModel=e,t.scaleX=t.scaleY=t.scaleVal,t.addChild(e),t.attackWidth=t.dbModel.width*Math.abs(t.scaleX),t.attackWidth=560,t.arrowHelper=MissileHelper.createArrowHelper("arrow.png",t,1,Enum_flyType.auto),t.initHpBar()}),e.prototype.initDb.call(this)},t.prototype.initHpBar=function(){var e=this;if(!e.hpBar){var t=e._unitKey.split("_");e.hpBar=HpBarPoolMgr.createHpBar(new egret.Point(-.25*e.width,-e.dbModel.height*(e.scaleVal+.25)),e,"player"==t[0])}},t}(BaseLifeDbModel);__reflect(RemoteDbSoldier.prototype,"RemoteDbSoldier");var RemoteSoldier=function(e){function t(){var t=e.call(this)||this,r=t;return r.speed=1600,t}return __extends(t,e),t.prototype.hit=function(){var e=this,t=e.partMap;for(var r in t){var o=t[r];if(o){e.Info.isScale;o.setActName("Attack")}}e.arrowHelper.shutTarget(e.enemy._mModel||e.enemy)},t.prototype.death=function(e){var t=this,r=t.partMap;for(var o in r){var n=r[o];n&&n.setActName("Die")}t.arrowHelper.dispose()},t.prototype.loadComplate=function(){var e=this;e._loadCallNum++,e._loadCount==e._loadCallNum&&(console.error("remote init call back!"),e.attackWidth=560,e.arrowHelper=MissileHelper.createArrowHelper("arrow.png",e,1,Enum_flyType.auto))},t.prototype.initPart=function(){var t=this;e.prototype.initPart.call(this);var r=t.Info;if(r.mount&&t._loadCount++,r.weapon&&t._loadCount++,r.body)if(r.fashion);else{var o=t.partMap[Enum_part.BODY]=AnimationItem.create();o.initAniItem("Soider",t,"Idle",t.loadComplate,t),t._loadCount++,t.addChild(o)}r.wing&&t._loadCount++},t}(BaseLifeModel);__reflect(RemoteSoldier.prototype,"RemoteSoldier");var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,r){function o(o){t.call(r,o,e)}if(RES.hasRes(e)){var n=RES.getRes(e);n?o(n):RES.getResAsync(e,o,this)}else RES.getResByUrl(e,o,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var KeyBoardHelper=function(){function e(){if(this.key_ups=new Array,this.key_downs=new Array,!egret.Capabilities.isMobile){var e=this;document.addEventListener("keyup",function(t){for(var r=0,o=e.key_ups.length;o>r;r++){var n=e.key_ups[r][0],i=e.key_ups[r][1];i?n.call(i,t.keyCode):n(t.keyCode)}}),document.addEventListener("keydown",function(t){for(var r=0,o=e.key_downs.length;o>r;r++){var n=e.key_downs[r][0],i=e.key_downs[r][1];i?n.call(i,t.keyCode):n(t.keyCode)}})}}return e.prototype.addKeyUp=function(e,t){this.key_ups.push([e,t])},e.prototype.addKeyDown=function(e,t){this.key_downs.push([e,t])},e.prototype.removeKeyUp=function(e,t){for(var r=0;r<this.key_ups.length;r++)this.key_ups[r][0]==e&&this.key_ups[r][1]==t&&(this.key_ups.splice(r,1),r--)},e.prototype.removeKeyDown=function(e,t){for(var r=0;r<this.key_downs.length;r++)this.key_downs[r][0]==e&&this.key_downs[r][1]==t&&(this.key_downs.splice(r,1),r--)},e}();__reflect(KeyBoardHelper.prototype,"KeyBoardHelper");var LayerManager=function(){function e(){this.TYPE_MAXNUM=3,this.regiestIdViewMap={},this.initedViewMap={},this.typeViewMap={}}return e.prototype.init=function(e){var t=this;t.mainScene=e,t.main_layer=new egret.DisplayObjectContainer,t.mainScene.addChild(t.main_layer),t.floor_layer=new egret.DisplayObjectContainer,t.mainScene.addChild(t.floor_layer),t.ui_layer=new egret.DisplayObjectContainer,t.mainScene.addChild(t.ui_layer),t.pop_layer=new egret.DisplayObjectContainer,t.mainScene.addChild(t.pop_layer),t.tips_layer=new egret.DisplayObjectContainer,t.mainScene.addChild(t.tips_layer)},e.prototype.initView=function(){var e=this;e.regiestView(UIConst.MAIN_VIEW,"MainView",1,MainView,e.main_layer),e.openView(UIConst.MAIN_VIEW)},e.prototype.getViewById=function(e){var t=this;return t.initedViewMap[e]?t.initedViewMap[e]:void 0},e.prototype.isRegiest=function(e){var t=this;return t.regiestIdViewMap[e]?!0:!1},e.prototype.regiestView=function(e,t,r,o,n,i){void 0===n&&(n=this.main_layer);var a=this;return a.isRegiest(e)?void console.error("请不要重复注册"):void(a.regiestIdViewMap[e]=[t,r,o,n,i])},e.prototype.openView=function(e,t){var r=this;if(!r.isRegiest(e))return void console.error("页面还没有注册！");var o=r.regiestIdViewMap[e],n=r.typeViewMap[o[1]],i=function(){var t=r.initedViewMap[e];if(t)return r.typeViewMap[o[1]]=t,t;var n=new o[2];return n.pid=e,n.pname=o[0],n.ptype=o[1],r.typeViewMap[o[1]]=n,r.initedViewMap[e]=n,n};if(n){if(n.pid==e)return;r.closeViewByType(n.ptype);var a=i();o[3].addChild(a),a.onOpen(t)}else{var a=i();o[3].addChild(a),a.onOpen(t)}},e.prototype.closeView=function(e){var t=this;if(!t.initedViewMap[e])return void console.error("没初始化过。");var r=t.initedViewMap[e];t.closeViewByType(r.ptype)},e.prototype.closeViewByType=function(e){for(var t=this,r=t.TYPE_MAXNUM;r>=e;r--){var o=t.typeViewMap[r];o&&(o.parent&&o.parent.removeChild(o),o.onClose(),delete t.typeViewMap[r])}},e.prototype.closeAllView=function(){var e=this;e.closeViewByType(1)},e}();__reflect(LayerManager.prototype,"LayerManager");var LoaderHelper=function(){function e(){this._loadImgList={},this._loaderQuene=[],this._imgCodeMap={},this._destroyMapList={}}return e.getUrl=function(t){return""!=e.HEADURL&&(t=e.HEADURL+"/"+t),t},e.instance=function(){var t=this;return t._loaderHelper||(t._loaderHelper=new e),t._loaderHelper},e.prototype.loader=function(e,t){var r=this,o=StringUtils.getSuffix(t);if(r._loadImgList[o])e.source=r._loadImgList[o].source;else if(r._destroyMapList[o])e.source=r._destroyMapList[o].source,r._loadImgList[o]={count:1,source:r._destroyMapList[o].source},delete r._destroyMapList[o];else{var n=new LoaderItem(o,t,e,0);r._loaderQuene.push(n)}r.loadQuene()},e.prototype.loadQuene=function(){var e=this;e._loaderQuene.length&&0!=e._loaderState&&(e._targetLoaderItem=e._loaderQuene.shift(),e._loaderState=e._targetLoaderItem._state=0,RES.getResByUrl(e._targetLoaderItem._source,e.loadCallBack,e,RES.ResourceItem.TYPE_IMAGE))},e.prototype.loadCallBack=function(e,t){console.error("loadCalLBack:",e,t);var r=this;r._targetLoaderItem._img.source=e,r._targetLoaderItem._state=r._loaderState=1,r._targetLoaderItem._source=e,r._targetLoaderItem._callBack&&r._targetLoaderItem._callBack(),r._loadImgList[r._targetLoaderItem._name]={count:1,source:e},r._imgCodeMap[r._targetLoaderItem._img.hashCode]=r._targetLoaderItem._name,r._targetLoaderItem=null,r.loadQuene()},e.prototype.reduceImg=function(e){var t=this,r=t._imgCodeMap[e.hashCode];if(r){var o=t._loadImgList[r];o&&(console.error("------------start------------"),console.error("改变前:",t._loadImgList[r].count),o.count--,console.error("改变后:",t._loadImgList[r].count),console.error("------------end------------"),o.count<=0&&(t._destroyMapList[r]=t._loadImgList[r],delete t._loadImgList[r]),e.source=null)}},e.prototype.checkDestroy=function(){var e=this;for(var t in e._destroyMapList){var r=e._destroyMapList[t];r&&delete e._destroyMapList[t]}},e.HEADURL="",e}();__reflect(LoaderHelper.prototype,"LoaderHelper");var LoaderItem=function(){function e(e,t,r,o,n){void 0===o&&(o=0);var i=this;i._name=e,i._source=t,i._img=r,i._state=o,i._callBack=n}return e}();__reflect(LoaderItem.prototype,"LoaderItem");var EventConst=function(){function e(){}return e.RESIZE_EVENT="RESIZE_EVENT",e.MAP_LOAD_COMPLATE="MAP_LOAD_COMPLATE",e.BATTLE_MODEL_DEATH="BATTLE_MODEL_DEATH",e.BATTLE_START="BATTLE_START",e}();__reflect(EventConst.prototype,"EventConst");var StateHelper=function(){function e(){}return e.createItemState=function(e,t,r,o){var n=new ItemState;n._type=e,n._beforeCall=r,n._afterCall=o,n._behaviorList=t;for(var i=0,a=0,s=t;a<s.length;a++){var l=s[a];l?0==e?l._loopTiem>i&&(i=l._loopTiem):i+=l._loopTiem:console.error("不是一个有效行为")}return n._loopTime=i,n},e.createBehaviorList=function(e){if(!e)return void console.error("传入的数据异常");for(var t=[],r=0;r<e.length;r++){var o=e[r];if(o){var n=new ItemBehavior;n._loopTiem=o.time,n._state=o.state,n._param=o.param,t.push(n)}}return t},e.createState=function(e,t,r,o){var n=this,i=n.createBehaviorList(t);return n.createItemState(e,i,r,o)},e.TYPE_QUENE=1,e.TYPE_SEQUEN=0,e}();__reflect(StateHelper.prototype,"StateHelper");var UIHelper=function(){function e(){}return e.addTouchState=function(e){var t=this;e&&(t._lstAnchorOffset=e.anchorOffsetY,e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,t.startPresss,t),e.addEventListener(egret.TouchEvent.TOUCH_CANCEL,t.endNormal,t),e.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,t.endNormal,t),e.addEventListener(egret.TouchEvent.TOUCH_END,t.endNormal,t))
},e.startPresss=function(e){var t=e.currentTarget;t.anchorOffsetY=-5},e.endNormal=function(e){var t=this,r=e.currentTarget;r.anchorOffsetY=t._lstAnchorOffset},e.removeTouchState=function(e){var t=this;e.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,t.startPresss,t),e.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,t.endNormal,t),e.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,t.endNormal,t),e.removeEventListener(egret.TouchEvent.TOUCH_END,t.endNormal,t)},e._lstAnchorOffset=-1,e}();__reflect(UIHelper.prototype,"UIHelper");var AnimationHelper=function(){function e(){this.list=[],this.invalid=0,this.last=0}return e.addEff=function(e,t,r,o,n,i,a,s,l,p){void 0===o&&(o=0),void 0===n&&(n=0),void 0===i&&(i=1e3),void 0===a&&(a=-1),void 0===s&&(s=!0);var c=this,u=c.instance.addEff1(e,r,o,n,i,a,s,t);return u._playCallBack=l,u._playCallObj=p,u},e.removeEff=function(e){var t=this;e&&t.instance.removeEff(e)},e.prototype.addEff1=function(e,t,r,o,n,i,a,s){var l=AnimationItem.create();l.initAniItem(e,t,s),l.aniInterv=n,l.startTime=egret.getTimer(),l.repeat=a,-1!=i?l.endTime=l.startTime+i:l.endTime=Number.MAX_VALUE;var p=this;return 0==p.list.length&&(TimerUtils.instance.listen(p.update,p,100),1&p.invalid&&(p.invalid=0,TimerUtils.instance.remove(p.clearList,p))),l.x=r,l.y=o,this.list.push(l),l},e.prototype.removeEff=function(e){var t=this,r=t.list.indexOf(e);e._playCallBack&&(e._playCallObj?e._playCallBack.call(e._playCallObj):e._playCallBack()),-1!=r&&(t.list[r]=null,1&t.invalid||(t.invalid|=1,TimerUtils.instance.listen(t.clearList,t,0,egret.getTimer()+1e3,!1))),e.parent&&e.parent.removeChild(e),e.dispose()},e.prototype.clearList=function(){var e=this;e.invalid=0,0==e.list.length&&TimerUtils.instance.remove(e.update,e)},e.prototype.update=function(e){var t=this,r=egret.getTimer();r-t.last>=70&&(t.last=r);for(var o=t.list,n=0,i=o.length;i>n;n++){var a=o[n];if(a)if(r>a.endTime)t.removeEff(a);else{var s=(r-a.startTime)/a.aniInterv;s>1&&(a.repeat?s-=s>>0:s=1),a.setPec(s)}}},e}();__reflect(AnimationHelper.prototype,"AnimationHelper");var AnimationItem=function(e){function t(){var t=e.call(this)||this;return t._perc=0,t._totalFrame=0,t._isShowView=!0,t._isLoad=!1,t}return __extends(t,e),t.create=function(){var e=t.POOL.length?t.POOL.pop():new t;return e},t.prototype.initAniItem=function(e,t,r,o,n){void 0===r&&(r="normal");var i=this;i._keyName=e,i._parentNode=t,i._actName=r,i._loadComplateCallFunc=o,i._loadCallObj=n,i.res=App.resMgr.refRes(i._keyName),i.initAnimation()},t.prototype.initAnimation=function(){var e=this;-1==e.res.useUnits.indexOf(e)&&e.res.useUnits.push(e),e.res.ready&&e.buildmc()},t.prototype.setVal=function(e){var t=this;if(e!=t._keyName){if(t.$bitmapData=null,t._movieData=null,t.res){var r=t.res.useUnits.indexOf(t);t.res.useUnits.splice(r,1),App.resMgr.reduceRes(t._keyName)}t._keyName=e,e?(t.res=App.resMgr.refRes(e),t.res.useUnits.push(t),t.buildmc()):(t.res=null,t.visible=!1)}},t.prototype.buildmc=function(){var e=this;e.res&&e.res.factory?(e._movieData=e.res.factory.generateMovieClipData(e._actName),e._curFrame=1,e.visible=e._isShowView,e.setPec(0),e._isLoad||(e._isLoad=!0,e._loadComplateCallFunc&&e._loadCallObj&&e._loadComplateCallFunc.call(e._loadCallObj))):e.visible=!1},t.prototype.setActName=function(e){var t=this;t._actName!=e&&(t._actName=e,t.buildmc())},t.prototype.setVisible=function(e){var t=this;t.visible=e,t._isShowView=e},t.prototype.setPec=function(e){var t=this;if(t._perc=e,t._movieData){var r=t._movieData,o=r.numFrames,n=e*o>>0;if(n>=o&&(n-=1),t._curFrame!=n){var i=r.frames[n];if(t._curFrame=n,i){if(r.spriteSheet){var a=r.spriteSheet._textureMap[i.res];if(!a){var s=r.textureData[i.res];a=r.spriteSheet.createTexture(i.res,s.x,s.y,s.w,s.h)}t.$setBitmapData(a)}t.$setAnchorOffsetX(-i.x),t.$setAnchorOffsetY(-i.y)}else t.$setAnchorOffsetX(0),t.$setAnchorOffsetY(0),t.texture=null}}else t.texture=null},t.prototype.dispose=function(){var e=this;e._isLoad=!1,e._totalFrame=1,e._parentNode=null,e.alpha=1,e.scaleX=e.scaleY=1,e.x=e.y=0,e.visible=!0,e._movieData=null,e.setVal(null),e.texture=null,e._curFrame=-1,e._perc=0,e.setVisible(!0),e._loadCallObj=null,e._loadComplateCallFunc=null,e._playCallBack=null,e._playCallObj=null,t.POOL.push(e)},t.POOL=[],t}(egret.Bitmap);__reflect(AnimationItem.prototype,"AnimationItem");var RESManager=function(e){function t(){var t=e.call(this)||this;return t.loadingLen=0,t.loadMAx=2,t.map={},t.loadQueue=[],t.ref0List=[],t}return __extends(t,e),t.prototype.refRes=function(e){var t=this,r=this.map[e];if(r){if(r.inDList){var o=t.ref0List.indexOf(r);r.inDList=!1,t.ref0List.splice(o,1)}}else r=ResObj.create(),r.val=e,t.map[e]=r,t.loadQueue.push(r),t.loadNext();return r.refCount++,r},t.prototype.reduceRes=function(e){var t=this.map[e];return t&&(t.refCount--,t.refCount<=0&&(t.inDList||(t.ref0Time=egret.getTimer(),t.inDList=!0,this.ref0List.push(t)))),t},t.prototype.onLoaded=function(){var e=this;e.loadingLen>0&&(e.loadingLen-=1),e.loadNext()},t.prototype.loadNext=function(){for(var e=this,t=e.loadQueue;e.loadingLen<e.loadMAx&&t.length;){var r=t.shift();r&&(e.loadingLen+=1,r.startLoad())}},t.prototype.checkDestory1=function(){var e=this,t=e.ref0List.length;if(t>0){var r=Math.ceil(t/4);r>25&&(r=25);for(var o=!1,n=0;r>n;n++){var i=e.ref0List[n],a=egret.getTimer()-i.ref0Time;a>6e4&&(i.inDList=!1,0==i.refCount&&(e.destoryRes(i),e.ref0List[n]=null,o=!0))}o&&ArrayUitls.cleannull(e.ref0List)}},t.prototype.destoryRes=function(e){if(!(e.state>=0&&e.state<2)){if(delete this.map[e.val],-1==e.state){var t=this.loadQueue.indexOf(e);t>=0&&this.loadQueue.splice(t,1)}e.dispose()}},t.prototype.getVersionUrl=function(e){return e},t}(egret.EventDispatcher);__reflect(RESManager.prototype,"RESManager");var ResObj=function(){function e(){this.ready=!1,this.state=-1,this.refCount=0,this.disposeTimes=0,this.proprity=1,this.useUnits=[]}return e.create=function(){var t=e.POOL.length?e.POOL.pop():new e;return t},e.prototype.startLoad=function(){var e=this;e.state=0,e.jsonUrl="resource/model/"+e.val+".json",RES.getResByUrl(e.jsonUrl,e.josnComplete,e)},e.prototype.josnComplete=function(e){var t=this;return null==e?(t.state=3,void App.resMgr.onLoaded()):(t.state=1,t.mcdata=e,t.textureUrl="resource/model/"+this.val+".png",void RES.getResByUrl(t.textureUrl,t.textureComplete,t))},e.prototype.textureComplete=function(e){var t=this;return null==e?(t.state=3,void App.resMgr.onLoaded()):(t.state=2,t.mctexture=e,App.resMgr.onLoaded(),void t.complete())},e.prototype.complete=function(){var e=this;e.factory=new egret.MovieClipDataFactory(e.mcdata,e.mctexture);var t=e.useUnits;e.ready=!0;for(var r=t.length-1;r>=0;r--){var o=t[r];o.buildmc()}t.length=0},e.prototype.dispose=function(){var e=this;if(e.mcdata&&(RES.destroyRes(e.jsonUrl),e.mcdata=null),e.mctexture){RES.destroyRes(e.textureUrl);var t=e.factory.spriteSheet;t.dispose();for(var r in t._textureMap)t._textureMap[r].dispose(),delete t._textureMap[r];e.mctexture=null}e.jsonUrl=e.textureUrl=null,e.state=-1,e.ready=!1,e.disposeTimes++},e.POOL=[],e}();__reflect(ResObj.prototype,"ResObj");var DbHelper=function(){function e(){}return e.init=function(){var e=this;e._dbFactory=dragonBones.EgretFactory.factory,e._dbQuene=new DbLoadQuene,e._dbQuene.initQuene(e._dbFactory)},e.loadDragonBones=function(e,t,r,o,n,i){var a=this;a._dbQuene.addItem({gName:t,texurePng:a._loadPath+e+"/"+r,texureJson:a._loadPath+e+"/"+o,dbJson:a._loadPath+e+"/"+n,loadComplateBack:i})},e.destoryDragonBones=function(e){var t=this;t._dbQuene.dispose(e)},e._loadPath="resource/model/role/",e}();__reflect(DbHelper.prototype,"DbHelper");var DbLoadQuene=function(){function e(){this.state=0,this._loadComplateNum=0}return e.prototype.initQuene=function(e){var t=this;t.loadQuene=[],t.destoryQuene={},t.loadedDbQuene={},t._dbFactory=e},e.prototype.addItem=function(e){var t=this;t.loadQuene.push(e),t.checkNext()},e.prototype.checkNext=function(){var e=this;if(0==e.state&&e.loadQuene.length>0){var t=e.loadQuene.shift();if(t||e.checkNext(),e.state=1,e._loadComplateNum=0,e.loadedDbQuene[t.gName])return e.loadedDbQuene[t.gName].count++,t.loadComplateBack(e._dbFactory.buildArmatureDisplay(t.gName)),e.state=0,void e.checkNext();if(e.destoryQuene[t.gName]){var r=e.destoryQuene[t.gName];delete e.destoryQuene[t.gName],r.count=1,e.loadedDbQuene[t.gName]=r,t.loadComplateBack(e._dbFactory.buildArmatureDisplay(t.gName)),e.state=0,e.checkNext()}else e._nowLoadItem=t,RES.getResByUrl(t.texurePng,e.loadTexurePngComplate,e),RES.getResByUrl(t.texureJson,e.loadTexureJsonComplate,e),RES.getResByUrl(t.dbJson,e.loadDbJsonComplate,e)}},e.prototype.loadTexurePngComplate=function(e,t){var r=this;r._texurePng=e,r._loadComplateNum++,r.checkLoad()},e.prototype.loadTexureJsonComplate=function(e,t){var r=this;r._texureJson=e,r._loadComplateNum++,r.checkLoad()},e.prototype.loadDbJsonComplate=function(e,t){var r=this;r._dbJson=e,r._loadComplateNum++,r.checkLoad()},e.prototype.checkLoad=function(){var e=this;if(3==e._loadComplateNum){e._loadComplateNum=0,e.state=0,e._dbFactory.parseDragonBonesData(e._dbJson),e._dbFactory.parseTextureAtlasData(e._texureJson,e._texurePng);var t=e.loadedDbQuene[e._nowLoadItem.gName]={db:e._dbFactory.buildArmatureDisplay(e._nowLoadItem.gName),name:e._dbJson.name,gRoot:e._nowLoadItem.gName,count:1};e._nowLoadItem.loadComplateBack(t.db),e._nowLoadItem=null,e._texureJson=null,e._texurePng=null,e._dbJson=null,e.checkNext()}else console.error("还没全部加载完 请稍等。")},e.prototype.dispose=function(e){var t=this,r=t.loadedDbQuene[e];if(!r)return void console.error("当前并没有在加载完成的列表中.");var o=r.count--;0>=o?(r.count=0,delete t.loadedDbQuene[e],t.destoryQuene[e]=r):t.loadedDbQuene[e]=r},e.prototype.checkDestory=function(){var e=this;for(var t in e.destoryQuene){var r=e.destoryQuene[t];r&&(e._dbFactory.removeDragonBonesData(r.name),e._dbFactory.removeTextureAtlasData(r.name))}},e}();__reflect(DbLoadQuene.prototype,"DbLoadQuene");var AStar2=function(){function e(){this.isEnd=!1,this._heuristic=this.diagonal,this._straightCost=1,this._diagCost=Math.SQRT2}return e.prototype.findPath=function(e,t,r){return this._grid=e,this.isEnd=!1,this._open=[],this._closed=[],this._startNode=t,this._endNode=r,this._startNode.g=0,this._startNode.h=this._heuristic(this._startNode),this._startNode.f=this._startNode.g+this._startNode.h,this._open[0]=this._startNode,this.search()},e.prototype.search=function(){for(var e;!this.isEnd;){var t,r=this._open.length;for(e=this._open[0],t=0,s=0;r>s;s++)this._open[s].f<e.f&&(e=this._open[s],t=s);this._open[t]=this._open[this._open.length-1],this._open.pop(),this._closed.push(e);for(var o=0>e.x-1?0:e.x-1,n=this._grid.numCols-1<e.x+1?this._grid.numCols-1:e.x+1,i=0>e.y-1?0:e.y-1,a=this._grid.numRows-1<e.y+1?this._grid.numRows-1:e.y+1,s=o;n>=s;s++)for(var l=i;a>=l;l++){var p=this._grid.getNode(s,l);if(p!=e&&p.walkable&&this._grid.getNode(e.x,p.y).walkable&&this._grid.getNode(p.x,e.y).walkable){var c=this._straightCost;e.x!=p.x&&e.y!=p.y&&(c=1.4);var u=e.g+c*p.costMultiplier,h=this._heuristic(p),d=u+h;-1!=this._open.indexOf(p)||-1!=this._closed.indexOf(p)?d<p.f&&(p.f=d,p.g=u,p.h=h,p.parent=e):(p.f=d,p.g=u,p.h=h,p.parent=e,this._open.push(p)),p==this._endNode&&(this.isEnd=!0)}}if(0==this._open.length)return console.log("no path found"),this.isEnd=!0,!1}return this.buildPath(),!0},e.prototype.floyd=function(){if(null!=this.path){this._floydPath=this.path.concat();var e=this._floydPath.length;if(e>2){var t=new NodePoint(0,0),r=new NodePoint(0,0);this.floydVector(t,this._floydPath[e-1],this._floydPath[e-2]);for(var o=this._floydPath.length-3;o>=0;o--)this.floydVector(r,this._floydPath[o+1],this._floydPath[o]),t.x==r.x&&t.y==r.y?this._floydPath.splice(o+1,1):(t.x=r.x,t.y=r.y)}for(e=this._floydPath.length,o=e-1;o>=0;o--)for(var n=0;o-2>=n;n++)if(0==this._grid.hasBarrier(this._floydPath[o].x,this._floydPath[o].y,this._floydPath[n].x,this._floydPath[n].y)){for(var i=o-1;i>n;i--)this._floydPath.splice(i,1);o=n,e=this._floydPath.length;break}}},e.prototype.floydVector=function(e,t,r){e.x=t.x-r.x,e.y=t.y-r.y},e.prototype.buildPath=function(){this._path=new Array;var e=this._endNode;for(this._path.push(e);e!=this._startNode;)e=e.parent,this._path.unshift(e)},Object.defineProperty(e.prototype,"path",{get:function(){return this._path},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"floydPath",{get:function(){return this._floydPath},enumerable:!0,configurable:!0}),e.prototype.manhattan=function(e){return Math.abs(e.x-this._endNode.x)*this._straightCost+Math.abs(e.y+this._endNode.y)*this._straightCost},e.prototype.euclidian=function(e){var t=e.x-this._endNode.x,r=e.y-this._endNode.y;return Math.sqrt(t*t+r*r)*this._straightCost},e.prototype.diagonal=function(e){var t=e.x-this._endNode.x<0?this._endNode.x-e.x:e.x-this._endNode.x,r=e.y-this._endNode.y<0?this._endNode.y-e.y:e.y-this._endNode.y,o=r>t?t:r,n=t+r;return 1.4*o+this._straightCost*(n-2*o)},Object.defineProperty(e.prototype,"visited",{get:function(){return this._open},enumerable:!0,configurable:!0}),e}();__reflect(AStar2.prototype,"AStar2");var Grid=function(){function e(e,t,r){this._numCols=e,this._numRows=t,this._cellSize=r,this._nodes=new Array;for(var o=0;o<this._numCols;o++){this._nodes[o]=[];for(var n=0;n<this._numRows;n++)this._nodes[o][n]=new NodePoint(o,n)}}return e.prototype.getNode=function(e,t){return this._nodes[e][t]},e.prototype.setWalkable=function(e,t,r){this._nodes[e][t].walkable=r},e.prototype.setAlphable=function(e,t,r){this._nodes[e][t].alphable=r},Object.defineProperty(e.prototype,"numCols",{get:function(){return this._numCols},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numRows",{get:function(){return this._numRows},enumerable:!0,configurable:!0}),e.prototype.hasBarrier=function(e,t,r,o){if(e==r&&t==o)return!1;var n,i,a,s,l,p=new egret.Point(e*this._cellSize+this._cellSize/2,t*this._cellSize+this._cellSize/2),c=new egret.Point(r*this._cellSize+this._cellSize/2,o*this._cellSize+this._cellSize/2),u=Math.abs(r-e),h=Math.abs(o-t),d=u>h?!0:!1;if(d)for(n=MathUtil.getLineFunc(p,c,0),a=Math.min(e,r),s=Math.max(e,r),i=a;s>i;i++){var f=i*this._cellSize+this._cellSize,_=n(f);l=this.getNodesUnderPoint(i+1,_/this._cellSize);for(var y in l)if(0==l[y].walkable)return!0}else for(n=MathUtil.getLineFunc(p,c,1),a=Math.min(t,o),s=Math.max(t,o),i=a;s>i;i++){var m=i*this._cellSize+this._cellSize,v=n(m);l=this.getNodesUnderPoint(v/this._cellSize,i+1);for(var y in l)if(0==l[y].walkable)return!0}return!1},e.prototype.getNodesUnderPoint=function(e,t,r){void 0===r&&(r=null);var o=[],n=e%1==0,i=t%1==0;if(n&&i?(o[0]=this.getNode(e-1,t-1),o[1]=this.getNode(e,t-1),o[2]=this.getNode(e-1,t),o[3]=this.getNode(e,t)):n&&!i?(o[0]=this.getNode(e-1,Math.floor(t)),o[1]=this.getNode(e,Math.floor(t))):!n&&i?(o[0]=this.getNode(Math.floor(e),t-1),o[1]=this.getNode(Math.floor(e),t)):o[0]=this.getNode(Math.floor(e),Math.floor(t)),r&&r.length>0)for(var a=0;a<o.length;a++)-1!=r.indexOf(o[a])&&(o.splice(a,1),a--);return o},e.prototype.findReplacer=function(e,t){var r;if(t.walkable)r=t;else{-1==t.buriedDepth&&(t.buriedDepth=this.getNodeBuriedDepth(t,Math.max(this._numCols,this._numRows)));for(var o,n=t.x-t.buriedDepth<0?0:t.x-t.buriedDepth,i=t.x+t.buriedDepth>this.numCols-1?this.numCols-1:t.x+t.buriedDepth,a=t.y-t.buriedDepth<0?0:t.y-t.buriedDepth,s=t.y+t.buriedDepth>this.numRows-1?this.numRows-1:t.y+t.buriedDepth,l=n;i>=l;l++)for(var p=a;s>=p;p++)l>n&&i>l&&p>a&&s>p||(o=this.getNode(l,p),o.walkable&&(o.getDistanceTo(e),r?o.distance<r.distance&&(r=o):r=o))}return r},e.prototype.calculateBuriedDepth=function(){for(var e,t=0;t<this._numCols;t++)for(var r=0;r<this._numRows;r++)e=this._nodes[t][r],e.walkable?e.buriedDepth=0:e.buriedDepth=this.getNodeBuriedDepth(e,Math.max(this._numCols,this._numRows))},e.prototype.getNodeBuriedDepth=function(e,t){void 0===t&&(t=10);for(var r=e.walkable?0:1,o=1;t>=o;){for(var n,i=e.x-o<0?0:e.x-o,a=e.x+o>this.numCols-1?this.numCols-1:e.x+o,s=e.y-o<0?0:e.y-o,l=e.y+o>this.numRows-1?this.numRows-1:e.y+o,p=i;a>=p;p++)for(var c=s;l>=c;c++)if(n=this.getNode(p,c),n!=e&&n.walkable)return r;r++,o++}return r},e}();__reflect(Grid.prototype,"Grid");var NodePoint=function(){function e(e,t){this.walkable=!0,this.alphable=!1,this.costMultiplier=1,this.buriedDepth=-1,this.x=e,this.y=t}return e.prototype.getDistanceTo=function(e){var t=e.x-this.x,r=e.y-this.y;return this.distance=Math.sqrt(t*t+r*r),this.distance},e}();__reflect(NodePoint.prototype,"NodePoint");var FontHelper=function(){function e(){var e=this;e._fontLoadQuene=new FontLoaderQuene}return e.prototype.loadBitmapLabelFont=function(e,t,r){var o=this,n=o._fontLoadQuene.loaderPool[e];n&&t.call(r,n);var i={keyName:e,loadCallBack:t,loadCallObj:r};o._fontLoadQuene.addLoadItem(i)},e}();__reflect(FontHelper.prototype,"FontHelper");var FontLoaderQuene=function(){function e(){this._loadPath="resource/fonts/";var e=this;e.loadPool=[],e.loaderPool={},e._nowLoadItem=null}return e.prototype.checkLoad=function(){var e=this;if(!e._nowLoadItem){var t=e._nowLoadItem=e.loadPool.shift();if(t){var r=e._loadPath+t.keyName+".fnt";RES.getResByUrl(r,e.loadComplate,e)}}},e.prototype.addLoadItem=function(e){var t=this;t.loadPool.push(e),t.checkLoad()},e.prototype.loadComplate=function(e){var t=this;e&&(t._nowLoadItem.loadCallBack.call(t._nowLoadItem.loadCallObj,e),t.loaderPool[t._nowLoadItem.keyName]=e,t._nowLoadItem=null),t.checkLoad()},e}();__reflect(FontLoaderQuene.prototype,"FontLoaderQuene");var BaseBytes=function(e){function t(t,r){return e.call(this,t,r)||this}return __extends(t,e),t.prototype.writeLong=function(e){e=parseInt(e.toString(),10),this.writeDouble(e)},t.prototype.readDouble=function(){throw new Error("use readLong")},t.prototype.readLong=function(){var t=e.prototype.readDouble.call(this);return t},t.prototype.readFmt=function(e,t){void 0===t&&(t=null),t||(t=[]);for(var r=0;r<e.length;r++){var o=e[r];if("B"==o)t[r]=this.readByte();else if("I"==o)t[r]=this.readInt();else if("L"==o)t[r]=this.readLong();else if("S"==o)t[r]=this.readShort();else if("U"==o)t[r]=this.readUTF();else if("J"==o)t[r]=JSON.parse(this.readUTF());else for(var n=this.readShort(),i=t[r]=[],a=0;n>a;a++)i[a]=this.readFmt(o)}return t},t}(egret.ByteArray);__reflect(BaseBytes.prototype,"BaseBytes");var NetConst=function(){function e(){}return e.LOGIN_REQ=100001,e.LOGIN_RES=100002,e}();__reflect(NetConst.prototype,"NetConst");var ByteArrayMsgByProtobuf=function(e){function t(){var t=e.call(this)||this;t.msgClass=null,t.protoConfig=null,t.protoConfigSymmetry=null;var r=t;r.msgClass={},r.protoConfig=ProtoConfig.key_map,r.protoConfigSymmetry={};for(var o=Object.keys(r.protoConfig),n=0,i=o.length;i>n;n++){var a=Number(o[n]),s=r.protoConfig[a];r.protoConfigSymmetry[s]=a}return t}return __extends(t,e),t.prototype.getMsgClass=function(e){var t=this,r=t.msgClass[e];return null==r&&(r=egret.getDefinitionByName(e),t.msgClass[e]=r),r},t.prototype.getMsgID=function(e){var t=this;return t.protoConfigSymmetry[e]},t.prototype.getMsgKey=function(e){var t=this;return t.protoConfig[e]},t.prototype.decode=function(e){var t=this,r=e.readShort(),o=e.readShort();if(console.error("接受到得长度是:"+(r-2)+"   协议消息id:"+o),e.bytesAvailable>=r-2){var n=new egret.ByteArray;e.readBytes(n,0,r-2);var i={};return i.key=t.getMsgKey(o),i.body=t.getMsgClass(i.key).decode(n.bytes),console.error("收到数据：","["+o+" "+i.key+"]",i.body),i}return null},t.prototype.encode=function(e){var t=this,r=t.getMsgID(e.key),o=t.getMsgClass(e.key),n=o.fromObject(e.body),i=o.encode(n).finish(),a=new egret.ByteArray(i);console.error("发送数据：","["+r+" "+e.key+"]",e.body);var s=new egret.ByteArray;return console.error("发送的包长:"+a.length),s.writeByte(a.length+6),s.writeShort(r),s.writeBytes(a),s},t}(ByteArrayMsg);__reflect(ByteArrayMsgByProtobuf.prototype,"ByteArrayMsgByProtobuf");var LMessageFormat=function(){function e(){}return e.getInstance=function(){return null==e._instance&&(e._instance=new e),e._instance},e.prototype.encode=function(e,t){return void 0===t&&(t=null),null==t&&(t=new BaseBytes),this.write(e,t),t},e.prototype.write=function(t,r){var o=Object.prototype.toString.call(t);if(null==t||void 0==t)r.writeByte(e.NULL);else if("[object Number]"==o)this.writeInt(t,r);else if("[object String]"==o)r.writeByte(e.UTF8),r.writeUTF(t);else if("[object Boolean]"==o)this.writeBoolean(t,r);else if("[object Array]"==o)this.writeArray(t,r);else if(""==o)this.writeBytes(t,r);else if("[object Object]"==o)this.writeMap(t,r);else;},e.prototype.writeBoolean=function(t,r){r.writeByte(e.BOOLEAN),r.writeBoolean(t)},e.prototype.writeInt=function(t,r){t>Number.MAX_VALUE?(r.writeByte(e.INT64),this.writeLong(t,r)):t>32767||-32768>t?(r.writeByte(e.INT32),r.writeInt(t)):t>127||-128>t?(r.writeByte(e.INT16),r.writeShort(t)):(r.writeByte(e.INT8),r.writeByte(t))},e.prototype.writeLong=function(e,t){t.writeInt(e<<32),t.writeUnsignedInt(32&e)},e.prototype.writeArray=function(t,r){r.writeByte(e.ARRAY);var o=t.length;r.writeShort(o);for(var n=0;o>n;n++){var i=t[n];this.write(i,r)}},e.prototype.writeBytes=function(t,r){var o=new BaseBytes;t.readBytes(o,0),o.position=0,r.writeByte(e.BYTE_ARRAY),r.writeInt(o.length),r.writeBytes(o)},e.prototype.writeMap=function(t,r){r.writeByte(e.STR_OBJECT_MAP);var o=this.caculateMapLength(t);r.writeShort(o);for(var n in t)r.writeUTF(n),this.write(t[n],r)},e.prototype.decode=function(e){return this.read(e)},e.prototype.read=function(t){var r=null,o=t.readByte();if(o==e.INT32)r=t.readInt();else if(o==e.INT64||o==e.FLOAT32)r=t.readLong();else if(o==e.INT16)r=t.readShort();else if(o==e.INT8)r=t.readByte();else if(o==e.UTF8)r=t.readUTF();else if(o==e.BOOLEAN)r=t.readBoolean();else if(o==e.ARRAY)r=this.readArray(t);else if(o==e.STR_OBJECT_MAP)r=this.readStr_ObjMap(t);else if(o==e.BYTE_ARRAY)r=this.readBaseBytes(t);else if(o==e.NULL)r=null;else{if(o!=e.BYTE_OBJECT_MAP)throw new Error("LMFORMAT_ERROR_TYPE:"+o);r=this.readByte_ObjMap(t)}return r},e.prototype.readLong=function(e){var t=e.readInt(),r=e.readUnsignedInt(),o=t<<32+r;return o},e.prototype.readStr_ObjMap=function(e){for(var t={},r=e.readShort(),o=0;r>o;o++){var n=e.readUTF(),i=this.read(e);t[n]=i}return t},e.prototype.readByte_ObjMap=function(e){for(var t={},r=e.readShort(),o=0;r>o;o++){var n=e.readByte(),i=this.read(e);t[n]=i}return t},e.prototype.readBaseBytes=function(e){var t=new BaseBytes,r=e.readInt();return e.readBytes(t,0,r),t},e.prototype.readArray=function(e){for(var t=[],r=e.readShort(),o=0;r>o;o++){var n=this.read(e);t.push(n)}return t},e.prototype.caculateMapLength=function(e){var t=0;for(var r in e)t++;return t},e.NULL=0,e.INT8=1,e.INT32=2,e.INT64=3,e.INT16=4,e.NUMBER=10,e.FLOAT32=11,e.BOOLEAN=6,e.UTF8=20,e.ARRAY=30,e.STR_OBJECT_MAP=40,e.BYTE_OBJECT_MAP=41,e.BYTE_ARRAY=50,e.AMF_BYTES=60,e.BITMAPDATA=70,e.COMPRESSBITMAPDATA=71,e}();__reflect(LMessageFormat.prototype,"LMessageFormat");var NetHelper=function(){function e(){}return e.load=function(e){var t=this;t._loadQuene.push(e),t.loadNext()},e.loadNext=function(){var e=this;if(!e._isLoad){var t=e._nowLoadItem=e._loadQuene.shift();if(t){e._isLoad=!0,e._urlLoader||(e._urlLoader=new egret.URLLoader,e._urlLoader.addEventListener(egret.Event.COMPLETE,e.loadSuccess,e),e._urlLoader.addEventListener(egret.IOErrorEvent.IO_ERROR,e.loadError,e)),e._urlLoader.dataFormat=t.dataType;var r=new egret.URLRequest(t.url);if(t.param){var o="",n=0;for(var i in t.param)0!=n&&(o+="&"),o+=i+"="+t.param[i],n++;r.data=new egret.URLVariables(o)}r.requestHeaders.push(new egret.URLRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8")),r.method=t.requestMethod,e._urlLoader.load(r)}}},e.loadSuccess=function(e){egret.log("onLoadComplete");var t=this,r=e.target,o=r.data;t._nowLoadItem&&t._nowLoadItem.loadCallBack&&t._nowLoadItem.loadCallBack.call(t._nowLoadItem.contextObj,o),t._nowLoadItem=null,t._isLoad=!1,t.loadNext()},e.loadError=function(){egret.error("onloadError");var e=this;e._nowLoadItem&&e._nowLoadItem.errCallBack&&e._nowLoadItem.errCallBack.call(e._nowLoadItem.contextObj),e._nowLoadItem=null,e._isLoad=!1,e.loadNext()},e._loadQuene=[],e._isLoad=!1,e}();__reflect(NetHelper.prototype,"NetHelper");var RequestItem=function(){function e(){this.requestMethod=egret.URLRequestMethod.GET}return e}();__reflect(RequestItem.prototype,"RequestItem");var Socket=function(){function e(){this._needReconnect=!1,this._maxReconnectCount=10,this._reconnectCount=0}return e.prototype.addEvents=function(){var e=this;e._socket.addEventListener(egret.ProgressEvent.SOCKET_DATA,e.onReceiveMessage,e),e._socket.addEventListener(egret.Event.CONNECT,e.onSocketOpen,e),e._socket.addEventListener(egret.Event.CLOSE,e.onSocketClose,e),e._socket.addEventListener(egret.IOErrorEvent.IO_ERROR,e.onSocketError,e)},e.prototype.removeEvents=function(){var e=this;e._socket.removeEventListener(egret.ProgressEvent.SOCKET_DATA,e.onReceiveMessage,e),e._socket.removeEventListener(egret.Event.CONNECT,e.onSocketOpen,e),e._socket.removeEventListener(egret.Event.CLOSE,e.onSocketClose,e),e._socket.removeEventListener(egret.IOErrorEvent.IO_ERROR,e.onSocketError,e)},e.prototype.onSocketOpen=function(){var e=this;e._reconnectCount=0,e._isConnecting=!0,e._connectFlag&&e._needReconnect?App.notice.notify(SocketConst.SOCKET_RECONNECT):App.notice.notify(SocketConst.SOCKET_CONNECT),e._connectFlag=!0},e.prototype.onSocketClose=function(){var e=this;e._isConnecting=!1,e._needReconnect?(App.notice.notify(SocketConst.SOCKET_START_RECONNECT),e.reconnect()):App.notice.notify(SocketConst.SOCKET_CLOSE)},e.prototype.onSocketError=function(){var e=this;e._needReconnect?e.reconnect():App.notice.notify(SocketConst.SOCKET_NOCONNECT),e._isConnecting=!1},e.prototype.onReceiveMessage=function(e){var t=this;t._msg.receive(this._socket)},e.prototype.initServer=function(e,t,r){var o=this;o._host=e,o._port=t,o._msg=r},e.prototype.connect=function(){var e=this;e._socket=new egret.WebSocket,e._msg instanceof ByteArrayMsg&&(e._socket.type=egret.WebSocket.TYPE_BINARY),console.error("WebSocket: "+e._host+":"+e._port),e.addEvents(),e._socket.connect(e._host,e._port)},e.prototype.reconnect=function(){var e=this;e.closeCurrentSocket(),e._reconnectCount++,e._reconnectCount<e._maxReconnectCount?e.connect():(e._reconnectCount=0,e._connectFlag?App.notice.notify(SocketConst.SOCKET_CLOSE):App.notice.notify(SocketConst.SOCKET_NOCONNECT))},e.prototype.send=function(e){var t=this;t._msg.send(t._socket,e)},e.prototype.close=function(){var e=this;e._connectFlag=!1,e.closeCurrentSocket()},e.prototype.closeCurrentSocket=function(){var e=this;e.removeEvents(),e._socket.close(),e._socket=null,e._isConnecting=!1},e.prototype.isConnecting=function(){var e=this;return e._isConnecting},e.prototype.debugInfo=function(e){App.notice.notify(SocketConst.SOCKET_DEBUG_INFO,e)},e}();__reflect(Socket.prototype,"Socket");var SocketConst=function(){function e(){}return e.SOCKET_CONNECT="SOCKET_CONNECT",e.SOCKET_RECONNECT="SOCKET_RECONNECT",e.SOCKET_START_RECONNECT="SOCKET_START_RECONNECT",e.SOCKET_CLOSE="SOCKET_CLOSE",e.SOCKET_DATA="SOCKET_DATA",e.SOCKET_NOCONNECT="SOCKET_NOCONNECT",e.SOCKET_DEBUG_INFO="SOCKET_DEBUG_INFO",e}();__reflect(SocketConst.prototype,"SocketConst");var UIConst=function(){function e(){}return e.MAIN_VIEW=1,e.GAME_VIEW=2,e.CHOOSE_VIEW=3,e}();__reflect(UIConst.prototype,"UIConst");var UTFMsgByJson=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.decode=function(e){return JSON.parse(e)},t.prototype.encode=function(e){return JSON.stringify(e)},t}(UTFMsg);__reflect(UTFMsgByJson.prototype,"UTFMsgByJson");var WebSocketMgr=function(e){function t(){var t=e.call(this)||this;return t.reqestMap={},t.handleMap={},t.requestID=1,t.socketCache=new egret.ByteArray,t.isDebug=1,t.ba=new egret.ByteArray,t}return __extends(t,e),t.prototype.init=function(){this.webSocket||(this.webSocket=new egret.WebSocket,this.webSocket.addEventListener(egret.Event.CONNECT,this.onConnect,this),this.webSocket.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onError,this),this.webSocket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onData,this),this.webSocket.addEventListener(egret.Event.CLOSE,this.onClose,this),this.webSocket.type=egret.WebSocket.TYPE_BINARY,this.bodyBytes=new BaseBytes)},t.prototype.delSocket=function(){this.webSocket&&(this.webSocket.removeEventListener(egret.Event.CONNECT,this.onConnect,this),this.webSocket.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onError,this),this.webSocket.removeEventListener(egret.ProgressEvent.SOCKET_DATA,this.onData,this),this.webSocket.removeEventListener(egret.Event.CLOSE,this.onClose,this),this.webSocket=null)},t.prototype.connect=function(e,t){var r=document.location.protocol.indexOf("https");if(e.indexOf("wss:")>=0)this.webSocket.connectByUrl(e);else if(-1!=r){var o="wss://"+e+":"+t+"/";console.log("connectWSS:"+o),this.webSocket.connectByUrl(o)}else this.webSocket.connect(e,t)},t.prototype.onConnect=function(e){this.connectCallBack&&this.connectCallBack(this,e)},t.prototype.onError=function(e){this.errorCallBack&&this.errorCallBack(this,e)},t.prototype.onClose=function(e){WorldSocketMgr.instance.close(!0)},t.prototype.onData=function(e){e.target.readBytes(this.socketCache),this.doMsg()},t.prototype.doMsg=function(){for(var e=this.bodyBytes,t=this.socketCache;t.bytesAvailable>=2;){var r=t.readUnsignedShort();if(!(t.bytesAvailable>=r-2)){t.position-=4;break}e.clear(),r-2>0&&(t.readBytes(e,0,r-2),e.position=0);var o=e.readUnsignedShort(),n=this.handleMap[o];n?(n.hand(n.t,e),t.bytesAvailable||t.clear()):(console.error("unregister:CMD="+o),t.bytesAvailable||t.clear())}},t.prototype.testData=function(e,t){for(var r=new BaseBytes,o=0;o<t.length;o+=2){var n=t[o],i=t[o+1];"B"==n?r.writeByte(i):"S"==n?r.writeShort(i):"I"==n?r.writeInt(i):"L"==n?r.writeDouble(i):"U"==n&&r.writeUTF(i)}r.position=0,this.testRecive(e,r)},t.prototype.testRecive=function(e,t){var r=this.handleMap[e];r&&r.hand(r.t,t)},t.prototype.regHand=function(e,t,r){this.handleMap[e]&&console.debug("重复注册WEBSOCKET"+e),this.handleMap[e]={id:e,hand:t,t:r}},t.prototype.sendCMDBytes=function(e,t,r){if(void 0===r&&(r=!0),this.webSocket.connected){r&&WorldSocketMgr.instance.isNet,window.DEBUGM&&console.log("send cmd:"+e);var o=this.ba;o.clear(),o.writeUnsignedShort(t.length+4),o.writeUnsignedShort(e),o.writeBytes(t),this.webSocket.writeBytes(o),this.webSocket.flush()}},t.prototype.request=function(e,t,r,o){void 0===o&&(o=null);var n=this.ba;n.clear(),n.writeUnsignedShort(t.length+4),n.writeUnsignedShort(e),n.writeBytes(t);var i={rid:this.requestID,cmd:e,t:o,hand:r};this.reqestMap[this.requestID]=i,this.webSocket.writeBytes(n),this.webSocket.flush(),this.requestID>65535&&(this.requestID=1),this.requestID++},t.prototype.clear=function(){this.webSocket.readBytes(this.socketCache),this.socketCache.clear(),this.bodyBytes.clear()},t}(NoticeHelper);__reflect(WebSocketMgr.prototype,"WebSocketMgr");var WorldSocketMgr=function(e){function t(){var t=e.call(this)||this;return t.socketCache=new egret.ByteArray,t.ba=new egret.ByteArray,t}return __extends(t,e),Object.defineProperty(t,"instance",{get:function(){return t._ins||(t._ins=new t),t._ins},enumerable:!0,configurable:!0}),t.prototype.connect=function(e,t){var r=this,o=r.webSocket;o||(o=r.webSocket=new egret.WebSocket,o.addEventListener(egret.Event.CONNECT,r.onConnect,r),o.addEventListener(egret.IOErrorEvent.IO_ERROR,r.onError,r),o.addEventListener(egret.ProgressEvent.SOCKET_DATA,r.onData,r),o.addEventListener(egret.Event.CLOSE,r.onClose,r),o.type=egret.WebSocket.TYPE_BINARY,r.bodyBytes=new BaseBytes),r.close(!0),console.log("开始链接中央服webSocket ip="+e+" port="+t),r._ip=e,r._port=t;var n=document.location.protocol.indexOf("https");if(e.indexOf("wss:")>=0||-1!=n){var i="wss://"+e+":"+t+"/";console.log("connectWSS:"+i),o.connectByUrl(i)}else o.connect(e,t)},t.prototype.appHide=function(e){e&&this.close()},t.prototype.close=function(e){void 0===e&&(e=!1);try{this.isNet?this.webSocket.close():e&&this.webSocket&&this.webSocket.close()}catch(t){}},Object.defineProperty(t.prototype,"isNet",{get:function(){return this.webSocket&&this.webSocket.connected?!0:!1
},enumerable:!0,configurable:!0}),t.prototype.onConnect=function(e){console.log("中央服webSocket链接成功")},t.prototype.onError=function(e){console.log("中央服webSocket失败")},t.prototype.onClose=function(e){console.log("中央服webSocket关闭");var t=this;t.webSocket.close()},t.prototype.onData=function(e){e.target.readBytes(this.socketCache),this.doMsg()},t.prototype.doMsg=function(){for(var e=this.bodyBytes;this.socketCache.bytesAvailable>=2;){var t=this.socketCache.readUnsignedShort();if(!(this.socketCache.bytesAvailable>=t-2)){this.socketCache.position-=4;break}e.clear(),t-2>0&&(this.socketCache.readBytes(e,0,t-2),e.position=0);var r=e.readUnsignedShort(),o=null;if(o){o.hand(o.t,e);var n,i=null;if(i)try{o.hand(i.t,e)}catch(a){console.error("world-socketError:REQUEST="+n)}this.socketCache.bytesAvailable||this.socketCache.clear()}else console.error("unregister:CMD="+r),this.socketCache.bytesAvailable||this.socketCache.clear()}},t.prototype.sendCMDBytes=function(e,t){if(this.isNet&&this.webSocket.connected){console.log("sendWorld cmd:"+e);var r=this.ba;r.clear(),r.writeUnsignedShort(t.length+4),r.writeUnsignedShort(e),r.writeBytes(t),this.webSocket.writeBytes(r),this.webSocket.flush()}},t}(NoticeHelper);__reflect(WorldSocketMgr.prototype,"WorldSocketMgr");var ProtoConfig=function(){function e(){}return e.key_map={2:"Location",1e4:"simple.user_login_c2s",10001:"simple.user_login_s2c"},e}();__reflect(ProtoConfig.prototype,"ProtoConfig");var MapManager=function(){function e(e){this.isLoading=!1,this.sumTileMap={},this.showTileMap={};var t=this;t.mView=e,t.titlmapLayer=new egret.DisplayObjectContainer,t.loader=new egret.ImageLoader,t.mView.addChild(t.titlmapLayer)}return e.prototype.initConfig=function(e){var t=this;return t.mapId==e?void console.error("正在这个场景中."):(t.mapId=e,t.mapHead=""+e,t.mapUrl="resource/map/"+e,void RES.getResByUrl(this.mapUrl+"/map.json",t.loadComplate,t,RES.ResourceItem.TYPE_JSON))},e.prototype.initGrid=function(e,t){var r=this,o=Math.ceil(e/AppConst.ITEM_NODE_SIZE),n=Math.ceil(t/AppConst.ITEM_NODE_SIZE);r.showTileMap={},r.sumTileMap={},r.titlmapLayer.numChildren>0&&r.titlmapLayer.removeChildren(),r.miniMap&&(r.miniMap.parent&&r.miniMap.parent.removeChild(r.miniMap),r.miniMap=null),r.mGrid=new Grid(o,n,AppConst.ITEM_NODE_SIZE)},e.prototype.loadComplate=function(t,r){var o=this;o.mapCfg=t,o.isLoading=!0,o.initGrid(o.mapCfg.width,o.mapCfg.height),o.loader.once(egret.Event.COMPLETE,o.miniResLoadComplete,o),o.loader.load(o.mapUrl+"/mini.png"),o.sceneRactang||(o.sceneRactang=new SceneRectangle(this)),o.sceneRactang.setSceneInfo(t.width,t.height),o.endCol=Math.ceil(o.mapCfg.width/e.TILE_WIDTH)-1,o.endRow=Math.ceil(o.mapCfg.height/e.TILE_HEIGHT)-1;for(var n=o.getFirstPreloadRange(),i=n.x,a=n.y,s=n.width>o.endCol?o.endCol:n.width,l=n.height>o.endRow?o.endRow:n.height,p=l;p>=a;p--)for(var c=s;c>=i;c--){var u=1e4*o.mapId+1e3*p+c,h=o.sumTileMap[u]=MapTile.CREATEFUNC(o,u,p,c);h.onAdd(),o.showTileMap[u]=h}for(var p=0;p<=o.endRow;p++)for(var c=0;c<=o.endCol;c++){var u=1e4*o.mapId+1e3*p+c;if(!o.sumTileMap[u]){var h=o.sumTileMap[u]=MapTile.CREATEFUNC(o,u,p,c);h.onAdd(),h.changedVis(!1)}}o.isLoading=!1,o.initMapObj(),o.checkVis(),App.notice.notify(EventConst.MAP_LOAD_COMPLATE)},e.prototype.initMapObj=function(){var e=RES.getRes("scene_left_home_png"),t=RES.getRes("scene_right_home_png"),r=new egret.Bitmap(e);r.x=80,r.y=500,r.anchorOffsetX=.5*r.width,r.anchorOffsetY=1*r.height,App.mapMgr.addUnit(r,"leftHome",!0);var o=new egret.Bitmap(t);o.x=1200,o.y=500,o.anchorOffsetX=.5*o.width,o.anchorOffsetY=1*o.height,App.mapMgr.addUnit(o,"rightHome",!0),r.scaleX=r.scaleY=o.scaleX=o.scaleY=.5},e.prototype.watchPos=function(){var e=this,t=e.getFirstPreloadRange(),r=t.x,o=t.y,n=t.width>e.endCol?e.endCol:t.width,i=t.height>e.endRow?e.endRow:t.height;for(var a in e.showTileMap){var s=e.showTileMap[a];if(!s)return;(s.r<o||s.r>i||s.c<r||s.c>n)&&(s.changedVis(!1),delete e.showTileMap[a])}for(var l=i;l>=o;l--)for(var p=n;p>=r;p--){var c=1e4*e.mapId+1e3*l+p;if(!e.showTileMap[c]){var u=this.sumTileMap[c];u&&(u.changedVis(!0),e.showTileMap[c]=u)}}},e.prototype.checkVis=function(){var e=this;if(!e.miniMap){var t=function(){e.checkVis(),TimerUtils.instance.remove(t,e)};TimerUtils.instance.listen(t,e,1500)}e.miniMap&&e.miniMap.parent&&(e.miniMap.visible=!1,e.miniMap.parent.removeChild(e.miniMap))},e.prototype.miniResLoadComplete=function(e){var t=this,r=e.currentTarget,o=r.data,n=new egret.Texture;n.bitmapData=o,t.miniMap=new egret.Bitmap(n),t.miniMap.width=t.mapCfg.width,t.miniMap.height=t.mapCfg.height,t.mView.addChildAt(t.miniMap,0)},e.prototype.getFirstPreloadRange=function(){var t=this.sceneRactang,r=t.x,o=t.y,n=Math.ceil(o/e.TILE_HEIGHT)>0?Math.ceil(o/e.TILE_HEIGHT)-1:Math.ceil(o/e.TILE_HEIGHT),i=Math.ceil(r/e.TILE_WIDTH)>0?Math.ceil(r/e.TILE_WIDTH)-1:Math.ceil(r/e.TILE_WIDTH),a=Math.ceil(AppConst.ORG_HEIGHT/e.TILE_HEIGHT)==this.endRow?this.endRow:Math.ceil(AppConst.ORG_HEIGHT/e.TILE_HEIGHT)+1,s=Math.ceil(AppConst.ORG_WIDTH/e.TILE_WIDTH)==this.endCol?this.endCol:Math.ceil(AppConst.ORG_WIDTH/e.TILE_WIDTH)+1;return{x:i,y:n,width:s+i,height:a+n}},e.TILE_WIDTH=255,e.TILE_HEIGHT=255,e}();__reflect(MapManager.prototype,"MapManager");var MapScene=function(){function e(){this.unitMap={},this.specialUnitMap={};var e=this;e.view=new egret.Sprite,e.view.touchEnabled=!0,e.view.touchChildren=!0,e.view.addEventListener(egret.TouchEvent.TOUCH_TAP,e.clickFunc,e),e.unitLayer=new egret.Sprite,App.layerMgr.floor_layer.addChild(e.view),e.mapMgr=new MapManager(e.view),e.view.addChild(e.unitLayer)}return e.prototype.clickFunc=function(e){var t=this;console.error("获取到点击的坐标为 --x:"+(e.stageX+Math.abs(t.view.x))+" --Y:"+(e.stageY+Math.abs(t.view.y)))},e.prototype.enterScene=function(e){var t=this;t.mapMgr.initConfig(e)},e.prototype.checkSort=function(){var e=this;for(var t in e.unitMap){var r=e.unitMap[t],o=r._mModel,n=e.unitLayer.getChildIndex(o),i=o.y;for(var a in e.unitMap)if(a!=t){var s=e.unitMap[a],l=s._mModel,p=e.unitLayer.getChildIndex(l),c=l.y;c>i&&p>n||e.unitLayer.swapChildren(o,l)}}},e.prototype.update=function(e){var t=this;for(var r in t.unitMap){var o=t.unitMap[r];o.update&&o.update(e)}t.checkSort()},e.prototype.getPos=function(e){var t=this,r=AppConst.ORG_WIDTH,o=AppConst.ORG_HEIGHT,n=e.x-r/2>>0,i=e.y-o/2>>0;return n>t.mapMgr.mapCfg.width-r&&(n=t.mapMgr.mapCfg.width-r),0>n&&(n=0),i>t.mapMgr.mapCfg.height-o&&(i=t.mapMgr.mapCfg.height-o),0>i&&(i=0),{x:-n,y:-i}},e.prototype.moveScene=function(e){var t=this;t.view.x=e.x,t.view.y=e.y},e.prototype.getUnit=function(e){var t=this;return t.unitMap[e]},e.prototype.addUnit=function(e,t,r){void 0===r&&(r=!1);var o=this;r?o.specialUnitMap[t]=e:o.unitMap[t]=e,o.unitLayer.addChild(e._mModel||e)},e.prototype.removeUnit=function(e,t){void 0===t&&(t=!1);var r=this,o=t?r.specialUnitMap:r.unitMap,n=o[e];if(n){if(egret.is(n,"BaseState")){var i=n._mModel;i&&i.dispose()}delete o[e],r.unitLayer.removeChild(n._mModel||n)}},e.prototype.getOtherUnit=function(e,t){var r=this,o=[];e=e.split("_")[0];for(var n in r.unitMap){if(1==t){if(-1==n.indexOf(e))continue}else if(-1!=n.indexOf(e))continue;var i=r.unitMap[n];i instanceof egret.Bitmap||o.push(i)}return o},e.prototype.getRangeTargetList=function(e,t,r){for(var o=this,n=o.getOtherUnit(e,r),i=o.unitMap[e],a=i._mModel||i,s=[],l=0,p=n;l<p.length;l++){var c=p[l];Math.pow(a.x-c.x,2)+Math.pow(a.y-c.y,2)>Math.pow(t,2)||s.push(c)}return s},e.prototype.getSpecialUnit=function(){var e=this,t=RandomUtils.getRangeNum(2,1),r="";return r=1==t?"leftHome":"rightHome",e.specialUnitMap[r]},e}();__reflect(MapScene.prototype,"MapScene");var MapTile=function(){function e(){this.imgUrl=null,this.imgTile=new egret.Bitmap}return e.CREATEFUNC=function(t,r,o,n){var i=e.POOL.length?e.POOL.pop():new e;return i.mapMgr=t,i.k=r,i.r=o,i.c=n,i},e.prototype.onAdd=function(){var e=this;e.imgTile.visible=!0,null==e.imgUrl&&(e.head=e.mapMgr.mapHead,e.imgUrl="resource/map/"+e.head+"/"+e.r+"_"+e.c+".png",RES.getResByUrl(e.imgUrl,e.onImgLoaded,e),e.mapMgr.titlmapLayer.addChild(e.imgTile))},e.prototype.onImgLoaded=function(e){var t=this;null!=t.imgUrl&&(t.imgTile.x=t.c*MapManager.TILE_WIDTH,t.imgTile.y=t.r*MapManager.TILE_HEIGHT,t.imgTile.texture=e,null==e&&App.resMgr.onLoaded())},e.prototype.changedVis=function(e){this.imgTile.visible=e},e.prototype.onRemove=function(){this.imgTile.visible=!1},e.prototype.dispose=function(){this.onRemove(),this.mapMgr.titlmapLayer.removeChild(this.imgTile),this.imgTile.texture&&(this.imgTile.texture.dispose(),this.imgTile.texture=null),RES.destroyRes(this.imgUrl),e.POOL.push(this),this.imgUrl=null},e.prototype.onEvent=function(e,t){},e.POOL=[],e}();__reflect(MapTile.prototype,"MapTile");var SceneRectangle=function(e){function t(t){var r=e.call(this,0,0,AppConst.ORG_WIDTH,AppConst.ORG_HEIGHT)||this,o=r;return o.mapMgr=t,r}return __extends(t,e),t.prototype.setSceneInfo=function(e,t){var r=this;r.sceneWidth=e,r.sceneHeight=t},t.prototype.updatePos=function(e){var t=this;t.lstPos&&this.isSameObj(t.lstPos,e)||(t.lstPos=e,t.y=e.y>t.sceneHeight-t.height?t.sceneHeight-t.height:e.y,t.x=e.x>t.sceneWidth-t.width?t.sceneWidth-t.width:e.x,t.mapMgr.watchPos(),App.mapMgr.moveScene({x:-e.x,y:-e.y}))},t.prototype.isSameObj=function(e,t){for(var r in t)if(t[r]!=e[r])return!1;return!0},t}(egret.Rectangle);__reflect(SceneRectangle.prototype,"SceneRectangle");var BattleTween=function(){function e(){this.list=[],this.threadMap={},this.cleanNullFlag=!1}return e.prototype.to=function(t,r,o,n,i,a){void 0===n&&(n=null),void 0===i&&(i=e.linear),void 0===a&&(a=0);var s;s=e.pool.length>0?e.pool.pop():new Thread,this.list.push(s),s.clean(),s.target=t,s.totleTime=o,s.delay=a,s.easing=i,s.complete=n;for(var l in r){var p=r[l],c=null!=p[0];c?(s.props[l]=p[0],s.targetProps[l]=p[1]):(s.props[l]=t[l],s.targetProps[l]=r[l])}return s},e.prototype.remove=function(t){for(var r,o=this.list.length,n=o-1;n>=0;n--)r=this.list[n],r&&r.target==t&&(e.pool.push(r),this.list[n]=null,this.cleanNullFlag=!0)},e.prototype.update=function(t){for(var r=this,o=r.list.length,n=0;o>n;n++){var i=r.list[n];if(null!=i){if(i.runTime+=t,!(i.runTime<i.delay)){var a=(i.runTime-i.delay)/i.totleTime;a=a>1?1:a;var s=i.easing(a),l=i.props,p=i.targetProps;for(var c in p){var u=l[c],h=p[c],d=u+s*(h-u);i.target[c]=d}if(i.runTime>i.totleTime+i.delay){r.cleanNullFlag=!0,r.list[n]=null,e.pool.push(i);var f=i.complete;i.clean(),null!=f&&f.apply(f)}}}else r.cleanNullFlag=!0}r.cleanNullFlag&&ArrayUitls.cleannull(r.list)},e.prototype.dispose=function(){this.list.forEach(function(t){t&&(t.clean(),e.pool.push(t))}),this.list.length=0},e.linear=function(e){return e},e.sin=function(e){var t=1.570795;return Math.sin(e*t)},e.sin06=function(e){var t=3.14159;return Math.sin(e*t*.7)},e.easeIn=function(e){return e*e*e},e.easeOut=function(e){var t=e-1;return t*t*t+1},e.easeOutBounce=function(e){var t,r=7.5625,o=2.75;return 1/o>e?t=r*Math.pow(e,2):2/o>e?(e-=1.5/o,t=r*Math.pow(e,2)+.75):2.5/o>e?(e-=2.25/o,t=r*Math.pow(e,2)+.9375):(e-=2.625/o,t=r*Math.pow(e,2)+.984375),t},e.pool=[],e}();__reflect(BattleTween.prototype,"BattleTween");var Thread=function(){function e(){this.props={},this.targetProps={}}return e.prototype.clean=function(){var e=this;e.runTime=0,e.totleTime=0,e.curTime=0,e.target=null,e.complete=null;for(var t in e.targetProps)delete e.targetProps[t],delete e.props[t]},e}();__reflect(Thread.prototype,"Thread");var MTween=function(){function e(){this.threads=[],this.isClear=0}return Object.defineProperty(e,"instance",{get:function(){return null==e._instance&&(e._instance=new e),e._instance},enumerable:!0,configurable:!0}),e.to=function(t,r,o,n,i,a,s,l,p){void 0===n&&(n=null);var c=e.instance.to(t,r,o,n,i,a,s,l,p);return c},e.remove=function(t){e.instance.removeTar(t)},e.prototype.to=function(e,t,r,o,n,i,a,s,l){void 0===o&&(o=null);var p=this,c=MTweenThread.create(e);return t&&c.to(t,r,o,a,s),l&&c.wait(l),null!=n&&c.call(n,i),p.add(c),c},e.prototype.add=function(e){e.queue.length&&!e.curterm?(e.nextTerm(),this.threads.push(e)):e.curterm&&console.error("使用Tween错误")},e.prototype.update=function(e){var t=this.threads,r=t.length;if(!(0>=r)){for(var o=0,n=0;r>n;n++){var i=t[n];if(i){var a=i.curterm;if(!a){console.error("错误使用tween，在call有创建或回收tween"),t[n]=null;continue}a.total+=e;var s=a.total/a.duration;s>1&&(s=1);var l=a.ease?a.ease(s):s;if(0==a.t)for(var p in a.targetProps)1==l?i.target[p]=a.targetProps[p]:i.target[p]=a.props[p]+(a.targetProps[p]-a.props[p])*l,a._onChangedFunc&&a._onChangedFunc.call(a._onChangedObj);if(s>=1){do var c=i.nextTerm();while(c);i.curterm||(t[n]=null,i.dispose(),o=1)}}else o=1}o&&!this.isClear&&(this.isClear+=1,egret.callLater(this.clearnull,this))}},e.prototype.removeTar=function(e){for(var t=this,r=t.threads,o=r.length-1;o>=0;o--){var n=r[o];n&&n.target==e&&(r[o]=null,n.dispose())}},e.prototype.removeThread=function(e){for(var t=this,r=t.threads,o=r.length-1;o>=0;o--){var n=r[o];n==e&&(r[o]=null,n.dispose())}},e.prototype.getTween=function(e){for(var t=this,r=t.threads,o=r.length-1;o>=0;o--){var n=r[o];if(n&&n.target==e)return n}return null},e.prototype.clearnull=function(){var e=this;e.isClear&&(e.isClear=0,ArrayUitls.cleannull(e.threads))},e.prototype.clean=function(){for(var e=this,t=0,r=e.threads.length;r>t;t++){var o=e.threads[t];o&&o.dispose()}e.threads.length=0,e.isClear=0},e.easeIn=function(e){return e*e*e},e.easeOut=function(e){var t=e-1;return t*t*t+1},e}();__reflect(MTween.prototype,"MTween");var MTweenThread=function(){function e(){this.index=0,this.queue=[]}return e.create=function(t){if(e.POOL.length)var r=e.POOL.pop();else r=new e;return r.target=t,r},e.prototype.nextTerm=function(){var e=this.curterm=this.queue[this.index++];if(e)if(0==e.t){var t=e.targetProps;for(var r in t)for(var r in t)e.props[r]=this.target[r]}else if(1==e.t);else if(2==e.t)return e._comp.apply(e._compThis,e._compArg),!0;return!1},e.prototype.to=function(e,t,r,o,n){void 0===r&&(r=null);var i=this,a=MTweenTerm.create();return a.duration=t,a.total=0,a.ease=r,a.targetProps=e,a.t=0,a._onChangedFunc=o,a._onChangedObj=n,this.queue.push(a),i},e.prototype.wait=function(e){var t=MTweenTerm.create();return t.t=1,t.total=0,t.duration=e,this.queue.push(t),this},e.prototype.call=function(e,t,r){void 0===t&&(t=null),void 0===r&&(r=null);var o=MTweenTerm.create();return o.t=2,o._comp=e,o._compThis=t,o._compArg=r,this.queue.push(o),this},e.prototype.clean=function(){var e=this;e.target=null;for(var t=0,r=this.queue.length;r>t;t++)this.queue[t].dispose();this.queue.length=0,this.index=0,this.curterm=null},e.prototype.dispose=function(){var t=this;e.POOL.push(t),t.clean()},e.POOL=[],e}();__reflect(MTweenThread.prototype,"MTweenThread");var MTweenTerm=function(){function e(){this.t=0,this.props={},this.duration=0,this.total=0}return e.create=function(){return this.PO.length?this.PO.pop():new e},e.prototype.dispose=function(){var t=this;for(var r in t.props)delete t.props[r];t.ease=null,t.total=0,t.duration=0,e.PO.push(this),t._compThis=null,t._comp=null,t._compArg=null,t._onChangedFunc=null,t._onChangedObj=null},e.PO=[],e}();__reflect(MTweenTerm.prototype,"MTweenTerm");var ArrayUitls=function(){function e(){}return e.cleannull=function(e){for(var t=e.length,r=0,o=0,n=0;t-r>n;n++){var i=e[n];if(!i){(0==n||n>o+r)&&r++,o=n;for(var a=n+r;t>a;a++){if(e[a]){e[n]=e[a],e[a]=null;break}r++}}}e.length=t-r},e.caculateLen=function(e){for(var t=0,r=e.length-1;r>=0;r--)e[r]&&t++;return t},e.insert=function(e,t,r){for(var o=e.length;o>r;o--)e[o]=e[o-1];e[r]=t},e.sort_NUMERIC=function(e,t){return e-t},e.sort_DESCENDING=function(e,t){return t-e},e.sort_RANDOM=function(e,t){return Math.random()>.5?-1:1},e.insertArray=function(e,t,r){for(var o=t.length,n=e.length;n>r;n--)e[n+o-1]=e[n-1];for(var i=0,n=r;r+o>n;n++)e[n]=t[i],i+=1},e.sort=function(t,r){void 0===r&&(r=16),e.sortFields=null,e.sortOptions=r,t.sort(e.sortItem)},e.sortOn=function(t,r,o){e.sortFields=r,null==o?e.sortOptions=0:e.sortOptions=o,t.sort(e.sortItem)},e.sortItem=function(t,r){if(null==e.sortFields)return e.sortResult(t,r,null,e.sortOptions);if(e.sortFields instanceof Array){var o=0,n=0,i=e.sortFields.length;if(e.sortOptions instanceof Array){for(o=0;i>o;o++)if(n=e.sortResult(t,r,e.sortFields[o],e.sortOptions[o]),0!=n||o==i-1)return n}else for(o=0;i>o;o++)if(n=e.sortResult(t,r,e.sortFields[o],e.sortOptions),0!=n||o==i-1)return n}return e.sortResult(t,r,String(e.sortFields),e.sortOptions)},e.sortResult=function(e,t,r,o){return null!=r&&(e=e[r],t=t[r]),e==t?0:0==o?e>t?1:-1:16==(16&o)?2==(2&o)?t-e:e-t:(1==(1&o)&&(e=null!=e?String(e).toLowerCase():null,t=null!=t?String(t).toLowerCase():null),2==(2&o)?e>t?-1:1:e>t?1:-1)},e.NONE=0,e.CASEINSENSITIVE=1,e.DESCENDING=2,e.NUMERIC=16,e.sortFields=null,e.sortOptions=null,e}();__reflect(ArrayUitls.prototype,"ArrayUitls");var ColorFilter=function(){function e(){}return e.GRAY_FLITER=new egret.ColorMatrixFilter([.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0]),e.YELLOW_FILTER=new egret.ColorMatrixFilter([1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0]),e.WHITE_FILTER=new egret.ColorMatrixFilter([1,1,1,0,0,1,1,1,0,0,1,1,1,0,0,0,0,0,1,0]),e.PURPLE_FILTER=new egret.ColorMatrixFilter([1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0]),e.BLACK_FILTER=new egret.ColorMatrixFilter([.1,0,0,0,0,0,.1,0,0,0,0,0,.1,0,0,0,0,0,1,0]),e.RED_FILTER=new egret.ColorMatrixFilter([1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0]),e.GOLD_FILTER=new egret.ColorMatrixFilter([1,0,0,0,40,0,1,0,0,40,0,0,0,0,0,0,0,0,1,0]),e}();__reflect(ColorFilter.prototype,"ColorFilter");var MathUtil=function(){function e(){}return e.getLineFunc=function(e,t,r){void 0===r&&(r=0);var o;if(e.x==t.x){if(0==r)throw new Error("两点所确定直线垂直于y轴，不能根据x值得到y值");return 1==r&&(o=function(t){return e.x}),o}if(e.y==t.y){if(0==r)o=function(t){return e.y};else if(1==r)throw new Error("两点所确定直线垂直于y轴，不能根据x值得到y值");return o}var n;n=(e.y-t.y)/(e.x-t.x);var i;return i=e.y-n*e.x,0==r?o=function(e){return n*e+i}:1==r&&(o=function(e){return(e-i)/n}),o},e.bezier=function(e,t){function r(e,t,r,o){return n.arrangement(t,r)*e*Math.pow(1-o,t-r)*Math.pow(o,r)}var o,n=this,i=e.length-1,a=0,s=0;for(o=0;i+1>o;o++)a+=r(e[o][0],i,o,t),s+=r(e[o][1],i,o,t);return[a,s]},e.factorial=function(e){if(isNaN(e)||0>=e||Math.floor(e)!==e)return 1;for(var t=1;e;)t*=e--;return t},e.arrangement=function(e,t){var r=this;return r.factorial(e)/(r.factorial(t)*r.factorial(e-t))},e}();__reflect(MathUtil.prototype,"MathUtil");var RandomUtils=function(){function e(){}return e.getRangeNum=function(e,t){return Math.floor(Math.random()*(e-t+1)+t)},e}();__reflect(RandomUtils.prototype,"RandomUtils");var SceneAnimation=function(){function e(){}return e.MovieStart=function(e){function t(e){m++,m==a&&r.removeChild(i)}var r=AppConst.stage,o=720,n=1280,i=new eui.Group;i.width=o,i.height=n,r.addChild(i);for(var a=40,s=5,l=a/s,p=0;a>p;p++){var c=o/s,u=n/l,h=p%s*c,d=Math.floor(p/s)*u,f=new egret.RenderTexture,_=(f.drawToTexture(r,new egret.Rectangle(h,d,c,u)),new egret.Bitmap);switch(_.texture=f,_.anchorOffsetX=c/2,_.anchorOffsetY=u/2,_.x=h+c/2,_.y=d+u/2,i.addChild(_),5==e&&(e=Math.ceil(4*Math.random())),e){case 1:MTween.to(_,{scaleX:0,scaleY:0,alpha:0,rotation:359},800,null,t,self);break;case 2:var y=-o;p%2||(y=2*o),MTween.to(_,{x:y,alpha:0},800,null,t,this);break;case 3:MTween.to(_,{scaleX:.2,scaleY:1,alpha:0,blurFliter:0},800,null,t,this);break;case 4:MTween.to(_,{alpha:0},900,null,t,this);break;default:MTween.to(_,{scaleX:1,scaleY:0,alpha:0},800,null,t,this)}}var m=0},e}();__reflect(SceneAnimation.prototype,"SceneAnimation");var StringUtils=function(){function e(){}return e.getSuffix=function(e,t){void 0===t&&(t="/");var r=e.lastIndexOf(t),o=e.substr(r+1);return o},e}();__reflect(StringUtils.prototype,"StringUtils");var TimerUtils=function(){function e(){this.tasks=[]}return Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e),e._instance},enumerable:!0,configurable:!0}),e.prototype.listen=function(e,t,r,o,n){void 0===r&&(r=1e3),void 0===o&&(o=0),void 0===n&&(n=!0);var i=this,a=i.getItem(e,t);return a||(a=TimerItem.create(),i.tasks.push(a)),a.callBack=e,a.thisObj=t,a.interval=r,null==o?a.nowTime=0:a.nowTime=o,a.repeat=n,a},e.prototype.remove=function(e,t){for(var r=this.tasks,o=r.length,n=!1,i=o-1;i>=0;i--){var a=r[i];if(a&&a.callBack==e&&a.thisObj==t){n=!0,r[i]=null,a.clean();break}}n&&ArrayUitls.cleannull(r)},e.prototype.removeItem=function(e){var t=this,r=t.tasks.indexOf(e);-1!=r&&(t.tasks[r]=null,e.clean())},e.prototype.has=function(e,t){for(var r=this.tasks,o=0,n=r.length;n>o;o++){var i=r[o];if(i&&i.callBack==e&&i.thisObj==t)return!0}return!1},e.prototype.getItem=function(e,t){for(var r=this.tasks,o=0,n=r.length;n>o;o++){var i=r[o];if(i&&i.callBack==e&&i.thisObj==t)return i}return null},e.prototype.run=function(e){var t=this,r=t.tasks,o=r.length;if(!(0>=o)){for(var n=!1,i=o-1;i>=0;i--){var a=r[i];if(a){if(!(e-a.nowTime<a.interval)){a.nowTime=e;var s=a.callBack,l=a.thisObj;a.repeat||(r[i]=null,a.clean(),n=!0),s.length>=1?s.call(l,e):s.call(l)}}else n=!0}n&&ArrayUitls.cleannull(r)}},e}();__reflect(TimerUtils.prototype,"TimerUtils");var TimerItem=function(){function e(){}return e.prototype.clean=function(){var t=this;t.callBack=null,t.thisObj=null,t.nowTime=t.interval=0,e.POOL.push(t)},e.create=function(){var t=e.POOL;return t.length>0?t.shift():new e},e.POOL=[],e}();__reflect(TimerItem.prototype,"TimerItem");